{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts: Inter & Outfit -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
      :root {
        --glass-bg: rgba(255,255,255,0.18);
        --glass-border: rgba(255,255,255,0.28);
        --glass-shadow: 0 8px 32px 0 rgba(31,38,135,0.13);
        --primary-blue: #2563eb;
        --radius-md: 0.375rem;
        --radius-lg: 1rem;
        --header-height: 96px;
        --aurora1: #6366f1;
        --aurora2: #22d3ee;
        --aurora3: #fbbf24;
      }
      /* --- LAYOUT FIJO Y SCROLL PREMIUM --- */
      body {
        font-family: 'Inter', 'Outfit', sans-serif;
        background: linear-gradient(135deg, #f9fafb 0%, #e0e7ff 100%);
        min-height: 100vh;
        width: 100vw;
        overflow: hidden;
        display: flex;
      }
      .main-wrapper {
        flex: 1 1 0%;
        display: flex;
        flex-direction: column;
        min-width: 0;
        min-height: 0;
        height: 100vh;
        overflow: hidden;
      }
      .header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        z-index: 2001;
        background: rgba(255,255,255,0.92);
        backdrop-filter: blur(12px) saturate(1.2);
        -webkit-backdrop-filter: blur(12px) saturate(1.2);
        box-shadow: 0 2px 16px #6366f122;
      }
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        z-index: 2002;
        overflow-y: auto !important;
        overflow-x: hidden;
        box-shadow: none !important;
        border: none !important;
        background: transparent !important;
        transition: width 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1), box-shadow 0.3s;
        border-radius: 0 !important;
      }
      .sidebar.show {
        width: 260px !important;
        min-width: 260px !important;
        max-width: 260px !important;
        background: linear-gradient(135deg, rgba(255,255,255,0.32) 60%, rgba(99,102,241,0.13) 100%),
                    linear-gradient(120deg, rgba(99,102,241,0.08) 0%, rgba(34,211,238,0.07) 100%) !important;
        box-shadow: 0 16px 48px 0 #6366f144, 0 2px 16px #6366f133, 0 8px 32px 0 #6366f1aa !important;
        border-right: 2.5px solid var(--glass-border) !important;
        padding: 2.2rem 1.2rem 1.2rem 0.7rem !important;
        overflow-y: auto !important;
      }
      .sidebar.hide {
        width: 0 !important;
        min-width: 0 !important;
        max-width: 0 !important;
        box-shadow: none !important;
        border: none !important;
        background: transparent !important;
        padding: 0 !important;
        overflow: hidden !important;
        pointer-events: none !important;
        visibility: hidden !important;
      }
      .sidebar.hide::before,
      .sidebar.hide::after {
        opacity: 0 !important;
        pointer-events: none !important;
        visibility: hidden !important;
      }
      .sidebar.show::before,
      .sidebar.show::after {
        opacity: 1 !important;
        pointer-events: auto !important;
        visibility: visible !important;
      }
      .sidebar-section {
        margin-bottom: 2.2rem;
        position: relative;
      }
      .sidebar-section:not(:last-child)::after {
        content: '';
        display: block;
        height: 2px;
        width: 80%;
        margin: 1.2rem auto 0 auto;
        background: linear-gradient(90deg, transparent 0%, #6366f1 50%, transparent 100%);
        opacity: 0.13;
        border-radius: 2px;
        animation: fadeIn 1.2s;
      }
      .sidebar-section-title {
        font-size: 1.13rem;
        font-weight: 700;
        color: #6366f1;
        margin: 0 0 1.1rem 0.7rem;
        letter-spacing: 0.5px;
        position: relative;
        padding-bottom: 0.5rem;
      }
      .sidebar-link {
        display: flex;
        align-items: center;
        padding: 0.85rem 1.2rem 0.85rem 1.7rem;
        border-radius: 1.1rem;
        color: #374151;
        font-weight: 500;
        font-size: 1.07rem;
        margin-bottom: 0.2rem;
        position: relative;
        overflow: hidden;
        background: transparent;
        transition: background 0.18s, color 0.18s, box-shadow 0.18s, transform 0.18s;
        box-shadow: 0 2px 8px #6366f111;
      }
      .sidebar-link i {
        margin-right: 0.9rem;
        font-size: 1.25rem;
        line-height: 1;
        filter: drop-shadow(0 2px 8px #6366f1aa);
        transition: color 0.18s, filter 0.18s, transform 0.18s;
      }
      .sidebar-link:hover i, .sidebar-link:focus i {
        color: #22d3ee;
        filter: drop-shadow(0 0 12px #22d3eecc);
        transform: scale(1.18) rotate(-8deg);
      }
      .sidebar-link:hover, .sidebar-link:focus {
        background: linear-gradient(90deg, #6366f1 10%, #22d3ee 90%);
        color: #fff;
        box-shadow: 0 8px 24px #6366f1aa;
        outline: none;
        transform: scale(1.03);
      }
      .sidebar-link.active {
        background: linear-gradient(90deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        box-shadow: 0 8px 24px #6366f1aa;
      }
      .sidebar-link.active::before {
        content: '';
        position: absolute;
        left: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        width: 6px;
        height: 60%;
        border-radius: 6px;
        background: linear-gradient(180deg, #6366f1 0%, #22d3ee 100%);
        box-shadow: 0 0 12px #6366f1cc;
        animation: sidebarAccent 3.5s ease-in-out infinite alternate;
        z-index: 1;
      }
      /* Sidebar badge: premium circular style */
      .sidebar-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 1.7em;
        height: 1.7em;
        min-width: 1.7em;
        min-height: 1.7em;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 0.98em;
        box-shadow: 0 2px 8px #6366f144, 0 0 8px #22d3ee88;
        border: 2px solid #fff2;
        margin-left: auto;
        margin-right: 0.2rem;
        padding: 0;
        animation: badgePop 1.8s infinite, badgeGlow 2.5s infinite alternate;
      }
      /* Scrollbar premium para sidebar */
      .sidebar::-webkit-scrollbar {
        width: 9px;
        background: transparent;
      }
      .sidebar::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #6366f1 60%, #22d3ee 100%);
        border-radius: 6px;
        box-shadow: 0 2px 8px #6366f144;
        border: 2px solid #fff2;
      }
      .sidebar::-webkit-scrollbar-track {
        background: transparent;
      }
      /* Firefox */
      .sidebar {
        scrollbar-width: thin;
        scrollbar-color: #6366f1 #e0e7ff;
      }
      /* Fondo partículas sutiles */
      .sidebar::after {
        content: '';
        position: absolute;
        inset: 0;
        pointer-events: none;
        background-image: url('https://www.transparenttextures.com/patterns/cubes.png');
        opacity: 0.07;
        z-index: 1;
      }
      .sidebar-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2.5rem;
        position: relative;
        z-index: 3;
      }
      .sidebar-logo {
        display: flex;
        align-items: center;
        font-size: 1.35rem;
        font-weight: 700;
        color: var(--primary-blue);
        letter-spacing: 0.5px;
        text-shadow: 0 2px 8px #c7d2fe44;
        gap: 0.7rem;
      }
      .sidebar-logo-icon {
        margin-right: 0.7rem;
        font-size: 2rem;
        filter: drop-shadow(0 2px 8px #6366f1aa);
        animation: pulse 2.5s infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 2.8rem;
        width: 2.8rem;
      }
      .sidebar-logo-text {
        display: flex;
        align-items: center;
        font-size: 1.45rem;
        font-weight: 700;
        color: var(--primary-blue);
        letter-spacing: 0.5px;
        text-shadow: 0 2px 8px #c7d2fe44;
        height: 2.8rem;
      }
      .sidebar-close-btn {
        display: flex;
        position: absolute;
        top: 1.2rem;
        right: 1.2rem;
        background: rgba(99,102,241,0.09);
        border: none;
        color: #6366f1;
        font-size: 1.5rem;
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1300;
        transition: background 0.18s;
      }
      .sidebar-close-btn:hover {
        background: rgba(99,102,241,0.18);
      }
      @media (max-width: 1024px) {
        .sidebar {
          left: 0;
          top: 0;
          height: 100vh;
          transform: translateX(-100%);
        }
        .sidebar.show {
          transform: translateX(0);
        }
        .sidebar.hide {
          transform: translateX(-100%);
          pointer-events: none !important;
          visibility: hidden !important;
        }
        .main-content {
          margin-left: 0 !important;
          width: 100vw !important;
          max-width: 100vw !important;
        }
      }
      @media (max-width: 640px) {
        .header {
          min-height: 56px;
        }
      }
      /* Elimina push por defecto en header y main-content */
      .header, .main-content {
        margin-left: 0 !important;
        width: 100vw;
        max-width: 100vw;
        transition: margin-left 0.35s cubic-bezier(.4,0,.2,1), width 0.35s cubic-bezier(.4,0,.2,1);
        background: transparent;
      }
      .header.pushed, .main-content.pushed {
        margin-left: 260px !important;
        width: calc(100vw - 260px);
        max-width: calc(100vw - 260px);
      }
      @media (max-width: 1024px) {
        .header.pushed, .main-content.pushed {
          margin-left: 0 !important;
          width: 100vw;
          max-width: 100vw;
        }
      }
      /* Cuando el sidebar está visible, empuja el header-content a la derecha */
      .header-content.pushed {
        margin-left: 260px !important;
        width: calc(100vw - 260px);
        max-width: calc(100vw - 260px);
        transition: margin-left 0.35s cubic-bezier(.4,0,.2,1), width 0.35s cubic-bezier(.4,0,.2,1);
      }
      @media (max-width: 1024px) {
        .header-content.pushed {
          margin-left: 0 !important;
          width: 100vw;
          max-width: 100vw;
        }
      }
      /* Glassmorphism y microinteracciones sutiles */
      .sidebar-link {
        transition: background 0.18s, color 0.18s, box-shadow 0.18s, transform 0.18s;
        box-shadow: 0 2px 8px #6366f111;
        border-radius: var(--radius-md);
      }
      .sidebar-link:hover, .sidebar-link:focus {
        background: linear-gradient(90deg, #6366f1 10%, #22d3ee 90%);
        color: #fff;
        box-shadow: 0 8px 24px #6366f1aa;
        outline: none;
        transform: scale(1.02);
      }
      .sidebar-link.active {
        background: linear-gradient(90deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        box-shadow: 0 8px 24px #6366f1aa;
      }
      /* Avatar profesional */
      .user-avatar {
        width: 2.3rem;
        height: 2.3rem;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px #6366f1aa;
        border: 2px solid #fff;
        position: relative;
      }
      /* Dropdown premium */
      .user-dropdown {
        background: rgba(255,255,255,0.97);
        border-radius: 1.1rem;
        box-shadow: 0 8px 32px 0 #6366f1aa, 0 2px 16px #6366f133;
        border: 1.5px solid rgba(99,102,241,0.13);
        min-width: 220px;
        padding: 1.1rem 0.7rem;
        margin-top: 0.7rem;
        right: 0;
        top: 100%;
        position: absolute;
        z-index: 2000;
        opacity: 0;
        pointer-events: none;
        transform: translateY(-10px) scale(0.98);
        transition: opacity 0.18s, transform 0.18s;
      }
      .user-dropdown.show {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0) scale(1);
      }
      .dropdown-section {
        margin-bottom: 0.7rem;
        padding-bottom: 0.7rem;
        border-bottom: 1px solid #e0e7ff;
      }
      .dropdown-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      .dropdown-link {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        padding: 0.65rem 1rem;
        border-radius: 0.8rem;
        font-size: 1.08rem;
        color: #374151;
        font-weight: 500;
        background: none;
        border: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        transition: background 0.16s, color 0.16s, box-shadow 0.16s;
        margin-bottom: 0.15rem;
      }
      .dropdown-link i {
        font-size: 1.15em;
        color: #6366f1;
        min-width: 1.5em;
        text-align: center;
        transition: color 0.16s;
      }
      .dropdown-link:hover, .dropdown-link:focus {
        background: linear-gradient(90deg, #6366f1 10%, #22d3ee 90%, #fff 100%);
        color: #fff;
        box-shadow: 0 2px 12px #6366f122;
        outline: none;
      }
      .dropdown-link:hover i, .dropdown-link:focus i {
        color: #fff;
      }
      .dropdown-link.danger {
        color: #ef4444;
        font-weight: 600;
        background: none;
        border: none;
        transition: background 0.16s, color 0.16s;
      }
      .dropdown-link.danger:hover, .dropdown-link.danger:focus {
        background: #fee2e2;
        color: #b91c1c;
      }
      .dropdown-link.danger i {
        color: #ef4444;
      }
      .dropdown-link.danger:hover i, .dropdown-link.danger:focus i {
        color: #b91c1c;
      }
      /* Ajuste para info de usuario en la cabecera del dropdown */
      .user-dropdown .user-avatar-premium {
        margin-right: 0.5rem;
        box-shadow: 0 2px 8px #6366f1aa;
      }
      .user-dropdown .user-name-premium {
        font-weight: 700;
        color: #2563eb;
        font-size: 1.08rem;
      }
      .user-dropdown .user-role-premium {
        font-size: 0.92rem;
        color: #64748b;
        font-weight: 500;
      }
      .user-dropdown .dropdown-section {
        margin-bottom: 0.7rem;
        padding-bottom: 0.7rem;
        border-bottom: 1px solid #e0e7ff;
      }
      .user-dropdown .dropdown-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      /* --- MEJORA PREMIUM: Dropdown de usuario ordenado y moderno --- */
      .user-dropdown {
        background: rgba(255,255,255,0.97);
        border-radius: 1.1rem;
        box-shadow: 0 8px 32px 0 #6366f1aa, 0 2px 16px #6366f133;
        border: 1.5px solid rgba(99,102,241,0.13);
        min-width: 220px;
        padding: 1.1rem 0.7rem;
        margin-top: 0.7rem;
        right: 0;
        top: 100%;
        position: absolute;
        z-index: 2000;
        opacity: 0;
        pointer-events: none;
        transform: translateY(-10px) scale(0.98);
        transition: opacity 0.18s, transform 0.18s;
      }
      .user-dropdown.show {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0) scale(1);
      }
      .dropdown-section {
        margin-bottom: 0.7rem;
        padding-bottom: 0.7rem;
        border-bottom: 1px solid #e0e7ff;
      }
      .dropdown-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      .dropdown-link {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        padding: 0.65rem 1rem;
        border-radius: 0.8rem;
        font-size: 1.08rem;
        color: #374151;
        font-weight: 500;
        background: none;
        border: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        transition: background 0.16s, color 0.16s, box-shadow 0.16s;
        margin-bottom: 0.15rem;
      }
      .dropdown-link i {
        font-size: 1.15em;
        color: #6366f1;
        min-width: 1.5em;
        text-align: center;
        transition: color 0.16s;
      }
      .dropdown-link:hover, .dropdown-link:focus {
        background: linear-gradient(90deg, #6366f1 10%, #22d3ee 90%, #fff 100%);
        color: #fff;
        box-shadow: 0 2px 12px #6366f122;
        outline: none;
      }
      .dropdown-link:hover i, .dropdown-link:focus i {
        color: #fff;
      }
      .dropdown-link.danger {
        color: #ef4444;
        font-weight: 600;
        background: none;
        border: none;
        transition: background 0.16s, color 0.16s;
      }
      .dropdown-link.danger:hover, .dropdown-link.danger:focus {
        background: #fee2e2;
        color: #b91c1c;
      }
      .dropdown-link.danger i {
        color: #ef4444;
      }
      .dropdown-link.danger:hover i, .dropdown-link.danger:focus i {
        color: #b91c1c;
      }
      /* Ajuste para info de usuario en la cabecera del dropdown */
      .user-dropdown .user-avatar-premium {
        margin-right: 0.5rem;
        box-shadow: 0 2px 8px #6366f1aa;
      }
      .user-dropdown .user-name-premium {
        font-weight: 700;
        color: #2563eb;
        font-size: 1.08rem;
      }
      .user-dropdown .user-role-premium {
        font-size: 0.92rem;
        color: #64748b;
        font-weight: 500;
      }
      .user-dropdown .dropdown-section {
        margin-bottom: 0.7rem;
        padding-bottom: 0.7rem;
        border-bottom: 1px solid #e0e7ff;
      }
      .user-dropdown .dropdown-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      /* --- HEADER LAYOUT RESTAURADO PREMIUM: Logo/título y acciones fijas, sin saltos ni apilados --- */
      .header-content {
        display: flex;
        align-items: center;
        min-height: var(--header-height);
        height: var(--header-height);
        width: 100%;
        min-width: 0;
        box-sizing: border-box;
        padding: 0 2.2rem;
        background: none;
        position: relative;
        overflow-x: hidden;
        justify-content: flex-start;
      }
      .header-logo-title {
        display: flex;
        align-items: center;
        min-width: 0;
        overflow-x: hidden;
        height: var(--header-height);
        /* Centrado vertical real con gap y sin padding extra */
        gap: 0.7rem;
      }
      .sidebar-logo-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 2.8rem;
        width: 2.8rem;
        font-size: 2rem;
      }
      .sidebar-logo-text {
        display: flex;
        align-items: center;
        font-size: 1.45rem;
        font-weight: 700;
        color: var(--primary-blue);
        letter-spacing: 0.5px;
        text-shadow: 0 2px 8px #c7d2fe44;
        height: 2.8rem;
      }
      .header-actions-fixed {
        position: fixed;
        right: 2.2rem;
        top: 0;
        height: var(--header-height);
        display: flex;
        align-items: center;
        z-index: 3000;
        background: transparent;
        min-width: 0;
        gap: 1.1rem;
      }
      .group-select-premium, .notification-btn-premium, .user-menu-premium {
        margin-top: 0;
        margin-bottom: 0;
        align-self: center;
      }
      .user-menu-premium {
        display: flex;
        align-items: center;
        height: 100%;
      }
      .user-button-premium {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        align-items: center;
      }
      @media (max-width: 1024px) {
        .header-content {
          flex-direction: column;
          align-items: stretch;
          padding: 0.5rem 1.1rem;
          height: auto;
          min-height: var(--header-height);
        }
        .header-actions-fixed {
          position: static;
          right: 0;
          top: 0;
          height: auto;
          margin-top: 0.5rem;
          width: 100%;
          justify-content: stretch;
          gap: 0.7rem;
        }
      }
      @media (max-width: 640px) {
        .header-content {
          flex-direction: column;
          align-items: stretch;
          padding: 0.3rem 0.5rem;
          height: auto;
          min-height: var(--header-height);
        }
        .header-actions-fixed {
          position: static;
          margin-top: 0.5rem;
          width: 100%;
          justify-content: stretch;
          gap: 0.5rem;
        }
      }
      /* Refuerzo para evitar scroll horizontal accidental */
      html, body, .main-content, .page-content {
        overflow-x: hidden !important;
        min-width: 0 !important;
        max-width: 100vw !important;
        box-sizing: border-box !important;
      }
      /* --- PREMIUM HEADER ELEMENTS: Glassmorphism, gradientes, sombras, microinteracciones --- */
      .group-select-premium {
        background: rgba(255,255,255,0.48);
        border: 2px solid rgba(99,102,241,0.18);
        box-shadow: 0 2px 12px #6366f122, 0 1px 4px #22d3ee22;
        border-radius: 1.2rem;
        padding: 0.45rem 2.7rem 0.45rem 1.1rem;
        font-size: 1.08rem;
        color: #2563eb;
        font-weight: 600;
        min-width: 160px;
        max-width: 220px;
        width: auto;
        appearance: none;
        outline: none;
        transition: box-shadow 0.18s, background 0.18s, border 0.18s, color 0.18s, transform 0.14s;
        position: relative;
        cursor: pointer;
        background-image: url('data:image/svg+xml;utf8,<svg fill="%236366f1" height="18" viewBox="0 0 20 20" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M7.293 7.293a1 1 0 011.414 0L10 8.586l1.293-1.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 010-1.414z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 0.9rem center;
        background-size: 1.1rem;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      .group-select-premium:focus, .group-select-premium:hover {
        background: rgba(99,102,241,0.13);
        border: 2px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        color: #2563eb;
        transform: scale(1.04);
      }
      .notification-btn-premium {
        position: relative;
        background: rgba(255,255,255,0.48);
        border: 2px solid rgba(99,102,241,0.18);
        box-shadow: 0 2px 12px #6366f122, 0 1px 4px #22d3ee22;
        border-radius: 1.2rem;
        padding: 0.55rem 1.1rem;
        font-size: 1.18rem;
        color: #6366f1;
        transition: box-shadow 0.18s, background 0.18s, border 0.18s, color 0.18s, transform 0.14s;
        outline: none;
        cursor: pointer;
        min-width: 2.7rem;
        min-height: 2.7rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .notification-btn-premium:focus, .notification-btn-premium:hover {
        background: rgba(99,102,241,0.13);
        border: 2px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        color: #2563eb;
        transform: scale(1.11) rotate(6deg);
      }
      .notification-btn-premium i.fas.fa-bell {
        font-size: 1.35em;
        z-index: 1;
        position: relative;
      }
      .notification-badge {
        position: absolute;
        top: 0.12em;
        right: 0.12em;
        z-index: 2;
        background: linear-gradient(90deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 0.68em;
        border-radius: 1em;
        padding: 0.08em 0.38em;
        min-width: 1.1em;
        min-height: 1.1em;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #fff2;
        box-shadow: 0 2px 8px #6366f144, 0 0 8px #22d3ee88;
        pointer-events: none;
      }
      .notification-badge {
        background: linear-gradient(90deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 0.85rem;
        border-radius: 1rem;
        padding: 0.13rem 0.6rem;
        position: absolute;
        top: 0.2rem;
        right: 0.2rem;
        box-shadow: 0 2px 8px #6366f144, 0 0 8px #22d3ee88;
        border: 1.5px solid #fff2;
        animation: badgePop 1.8s infinite, badgeGlow 2.5s infinite alternate;
      }
      @keyframes badgeGlow {
        0% { box-shadow: 0 2px 8px #6366f144, 0 0 8px #22d3ee44; }
        100% { box-shadow: 0 2px 16px #22d3ee99, 0 0 16px #6366f1cc; }
      }
      .user-avatar-premium {
        width: 2.3rem;
        height: 2.3rem;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px #6366f1aa;
        border: 2.5px solid #fff;
        position: relative;
        transition: box-shadow 0.18s, border 0.18s, transform 0.14s;
      }
      .user-button-premium:focus .user-avatar-premium, .user-button-premium:hover .user-avatar-premium {
        border: 2.5px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        transform: scale(1.08) rotate(-4deg);
      }
      .user-button-premium {
        background: rgba(255,255,255,0.38);
        border: 1.5px solid rgba(99,102,241,0.18);
        box-shadow: 0 2px 12px #6366f122, 0 1px 4px #22d3ee22;
        border-radius: 1.2rem;
        padding: 0.35rem 1.1rem 0.35rem 0.7rem;
        font-size: 1.08rem;
        color: #6366f1;
        transition: box-shadow 0.18s, background 0.18s, border 0.18s, color 0.18s, transform 0.14s;
        outline: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.7rem;
      }
      .user-button-premium:focus, .user-button-premium:hover {
        background: rgba(99,102,241,0.13);
        border: 1.5px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        color: #2563eb;
        transform: scale(1.04);
      }
      /* Ripple effect premium */
      .ripple {
        position: absolute;
        border-radius: 50%;
        transform: scale(0);
        animation: rippleAnim 0.7s cubic-bezier(.4,2,.3,1);
        background: radial-gradient(circle, #6366f1 0%, #22d3ee 60%, transparent 100%);
        opacity: 0.18;
        pointer-events: none;
        z-index: 10;
      }
      @keyframes rippleAnim {
        to {
          transform: scale(2.5);
          opacity: 0;
        }
      }
      /* Focus visible premium */
      a:focus-visible, .sidebar-link:focus-visible, .dropdown-link:focus-visible, .header-button:focus-visible, .btn:focus-visible {
        outline: 2.5px solid #6366f1;
        outline-offset: 2px;
        box-shadow: 0 0 0 4px #6366f1aa;
      }
      /* Sombra y contraste premium */
      .sidebar, .header, .main-content, .user-dropdown, .sidebar-link, .dropdown-link, .sidebar-close-btn, .header-search, .user-avatar {
        box-shadow: 0 8px 32px 0 #6366f1aa, 0 2px 16px #6366f133;
      }
      /* Microinteracciones y animaciones sutiles */
      .sidebar, .header, .main-content, .sidebar-link, .dropdown-link, .sidebar-close-btn, .header-search, .user-avatar {
        transition: box-shadow 0.18s, background 0.18s, color 0.14s, transform 0.14s;
      }
      /* Responsividad extra */
      @media (max-width: 900px) {
        .header-search input { width: 100px; }
      }
      @media (max-width: 640px) {
        .user-avatar { width: 2rem; height: 2rem; font-size: 1rem; }
        .header-search input { width: 60px; }
      }
      .sidebar-header,
      .sidebar-nav {
        position: relative;
        z-index: 3;
      }
      .sidebar.hide::before,
      .sidebar.hide::after {
        opacity: 0 !important;
        pointer-events: none !important;
        visibility: hidden !important;
      }
      .sidebar.show::before,
      .sidebar.show::after {
        opacity: 1 !important;
        pointer-events: auto !important;
        visibility: visible !important;
      }
      /* Fondo glassmorphism real para sidebar */
      .sidebar {
        background: linear-gradient(135deg, rgba(255,255,255,0.32) 60%, rgba(99,102,241,0.13) 100%),
                    linear-gradient(120deg, rgba(99,102,241,0.08) 0%, rgba(34,211,238,0.07) 100%);
        border-right: 2.5px solid var(--glass-border);
        box-shadow: 0 16px 48px 0 #6366f144, 0 2px 16px #6366f133, 0 8px 32px 0 #6366f1aa;
        backdrop-filter: blur(24px) saturate(1.5);
        -webkit-backdrop-filter: blur(24px) saturate(1.5);
        border-radius: 0 1.5rem 1.5rem 0;
        padding: 2.2rem 1.2rem 1.2rem 0.7rem;
        box-sizing: border-box;
        overflow-x: hidden;
        position: relative;
      }
      /* Fondo body y main-wrapper nunca blanco */
      body, .main-wrapper {
        background: linear-gradient(135deg, #f9fafb 0%, #e0e7ff 100%) !important;
      }
      /* Elimina cualquier borde o sombra no deseada en main-wrapper */
      .main-wrapper {
        box-shadow: none !important;
        border: none !important;
      }
      /* Push solo en desktop */
      .main-content.pushed, .header.pushed {
        margin-left: 260px !important;
        width: calc(100vw - 260px);
        max-width: calc(100vw - 260px);
      }
      @media (max-width: 1024px) {
        .main-content.pushed, .header.pushed {
          margin-left: 0 !important;
          width: 100vw;
          max-width: 100vw;
        }
      }
      /* --- HEADER LAYOUT RESTAURADO PREMIUM: Logo/título y acciones fijas, sin saltos ni apilados --- */
      .header-content {
        display: flex;
        align-items: center;
        min-height: var(--header-height);
        height: var(--header-height);
        width: 100%;
        min-width: 0;
        box-sizing: border-box;
        padding: 0 2.2rem;
        background: none;
        position: relative;
        overflow-x: hidden;
        justify-content: flex-start;
      }
      .header-logo-title {
        display: flex;
        align-items: center;
        min-width: 0;
        overflow-x: hidden;
        height: var(--header-height);
        /* Centrado vertical real con gap y sin padding extra */
        gap: 0.7rem;
      }
      .sidebar-logo-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 2.8rem;
        width: 2.8rem;
        font-size: 2rem;
      }
      .sidebar-logo-text {
        display: flex;
        align-items: center;
        font-size: 1.45rem;
        font-weight: 700;
        color: var(--primary-blue);
        letter-spacing: 0.5px;
        text-shadow: 0 2px 8px #c7d2fe44;
        height: 2.8rem;
      }
      .header-actions-fixed {
        position: fixed;
        right: 2.2rem;
        top: 0;
        height: var(--header-height);
        display: flex;
        align-items: center;
        z-index: 3000;
        background: transparent;
        min-width: 0;
        gap: 1.1rem;
      }
      .group-select-premium, .notification-btn-premium, .user-menu-premium {
        margin-top: 0;
        margin-bottom: 0;
        align-self: center;
      }
      .user-menu-premium {
        display: flex;
        align-items: center;
        height: 100%;
      }
      .user-button-premium {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        align-items: center;
      }
      @media (max-width: 1024px) {
        .header-content {
          flex-direction: column;
          align-items: stretch;
          padding: 0.5rem 1.1rem;
          height: auto;
          min-height: var(--header-height);
        }
        .header-actions-fixed {
          position: static;
          right: 0;
          top: 0;
          height: auto;
          margin-top: 0.5rem;
          width: 100%;
          justify-content: stretch;
          gap: 0.7rem;
        }
      }
      @media (max-width: 640px) {
        .header-content {
          flex-direction: column;
          align-items: stretch;
          padding: 0.3rem 0.5rem;
          height: auto;
          min-height: var(--header-height);
        }
        .header-actions-fixed {
          position: static;
          margin-top: 0.5rem;
          width: 100%;
          justify-content: stretch;
          gap: 0.5rem;
        }
      }
      /* Refuerzo para evitar scroll horizontal accidental */
      html, body, .main-content, .page-content {
        overflow-x: hidden !important;
        min-width: 0 !important;
        max-width: 100vw !important;
        box-sizing: border-box !important;
      }
      /* --- PREMIUM HEADER ELEMENTS: Glassmorphism, gradientes, sombras, microinteracciones --- */
      .group-select-premium {
        background: rgba(255,255,255,0.48);
        border: 2px solid rgba(99,102,241,0.18);
        box-shadow: 0 2px 12px #6366f122, 0 1px 4px #22d3ee22;
        border-radius: 1.2rem;
        padding: 0.45rem 2.7rem 0.45rem 1.1rem;
        font-size: 1.08rem;
        color: #2563eb;
        font-weight: 600;
        min-width: 160px;
        max-width: 220px;
        width: auto;
        appearance: none;
        outline: none;
        transition: box-shadow 0.18s, background 0.18s, border 0.18s, color 0.18s, transform 0.14s;
        position: relative;
        cursor: pointer;
        background-image: url('data:image/svg+xml;utf8,<svg fill="%236366f1" height="18" viewBox="0 0 20 20" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M7.293 7.293a1 1 0 011.414 0L10 8.586l1.293-1.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 010-1.414z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 0.9rem center;
        background-size: 1.1rem;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      .group-select-premium:focus, .group-select-premium:hover {
        background: rgba(99,102,241,0.13);
        border: 2px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        color: #2563eb;
        transform: scale(1.04);
      }
      .notification-btn-premium {
        position: relative;
        background: rgba(255,255,255,0.48);
        border: 2px solid rgba(99,102,241,0.18);
        box-shadow: 0 2px 12px #6366f122, 0 1px 4px #22d3ee22;
        border-radius: 1.2rem;
        padding: 0.55rem 1.1rem;
        font-size: 1.18rem;
        color: #6366f1;
        transition: box-shadow 0.18s, background 0.18s, border 0.18s, color 0.18s, transform 0.14s;
        outline: none;
        cursor: pointer;
        min-width: 2.7rem;
        min-height: 2.7rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .notification-btn-premium:focus, .notification-btn-premium:hover {
        background: rgba(99,102,241,0.13);
        border: 2px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        color: #2563eb;
        transform: scale(1.11) rotate(6deg);
      }
      .notification-btn-premium i.fas.fa-bell {
        font-size: 1.35em;
        z-index: 1;
        position: relative;
      }
      .notification-badge {
        position: absolute;
        top: 0.12em;
        right: 0.12em;
        z-index: 2;
        background: linear-gradient(90deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 0.68em;
        border-radius: 1em;
        padding: 0.08em 0.38em;
        min-width: 1.1em;
        min-height: 1.1em;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #fff2;
        box-shadow: 0 2px 8px #6366f144, 0 0 8px #22d3ee88;
        pointer-events: none;
      }
      .notification-badge {
        background: linear-gradient(90deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 0.85rem;
        border-radius: 1rem;
        padding: 0.13rem 0.6rem;
        position: absolute;
        top: 0.2rem;
        right: 0.2rem;
        box-shadow: 0 2px 8px #6366f144, 0 0 8px #22d3ee88;
        border: 1.5px solid #fff2;
        animation: badgePop 1.8s infinite, badgeGlow 2.5s infinite alternate;
      }
      @keyframes badgeGlow {
        0% { box-shadow: 0 2px 8px #6366f144, 0 0 8px #22d3ee44; }
        100% { box-shadow: 0 2px 16px #22d3ee99, 0 0 16px #6366f1cc; }
      }
      .user-avatar-premium {
        width: 2.3rem;
        height: 2.3rem;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 60%, #22d3ee 100%);
        color: #fff;
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px #6366f1aa;
        border: 2.5px solid #fff;
        position: relative;
        transition: box-shadow 0.18s, border 0.18s, transform 0.14s;
      }
      .user-button-premium:focus .user-avatar-premium, .user-button-premium:hover .user-avatar-premium {
        border: 2.5px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        transform: scale(1.08) rotate(-4deg);
      }
      .user-button-premium {
        background: rgba(255,255,255,0.38);
        border: 1.5px solid rgba(99,102,241,0.18);
        box-shadow: 0 2px 12px #6366f122, 0 1px 4px #22d3ee22;
        border-radius: 1.2rem;
        padding: 0.35rem 1.1rem 0.35rem 0.7rem;
        font-size: 1.08rem;
        color: #6366f1;
        transition: box-shadow 0.18s, background 0.18s, border 0.18s, color 0.18s, transform 0.14s;
        outline: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.7rem;
      }
      .user-button-premium:focus, .user-button-premium:hover {
        background: rgba(99,102,241,0.13);
        border: 1.5px solid #6366f1;
        box-shadow: 0 4px 24px #6366f1aa, 0 2px 8px #22d3ee33;
        color: #2563eb;
        transform: scale(1.04);
      }
      /* --- PREMIUM SIDEBAR MENU ICON (ajuste mediano, profesional, sin efectos grotesos) --- */
      #sidebarMenuBtn {
        background: rgba(255,255,255,0.38);
        border: 1.5px solid rgba(99,102,241,0.13);
        box-shadow: 0 1px 6px #6366f122, 0 1px 2px #22d3ee22;
        border-radius: 1.1rem;
        padding: 0.38rem 0.85rem;
        font-size: 1.08rem;
        color: #6366f1;
        transition: box-shadow 0.16s, background 0.16s, border 0.16s, color 0.16s, transform 0.12s;
        outline: none;
        cursor: pointer;
        min-width: 2.1rem;
        min-height: 2.1rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }
      #sidebarMenuBtn:focus, #sidebarMenuBtn:hover {
        background: rgba(99,102,241,0.13);
        border: 1.5px solid #6366f1;
        box-shadow: 0 2px 12px #6366f1aa, 0 1px 4px #22d3ee33;
        color: #2563eb;
      }
      #sidebarMenuBtn i {
        font-size: 1.25em;
        background: linear-gradient(90deg, #6366f1 30%, #22d3ee 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        transition: filter 0.16s, color 0.16s, transform 0.16s;
        filter: drop-shadow(0 1px 4px #6366f1aa);
        border-radius: 50%;
        padding: 0.08em 0.18em;
        box-shadow: none;
        animation: none;
      }
      #sidebarMenuBtn:focus i, #sidebarMenuBtn:hover i {
        filter: drop-shadow(0 0 8px #22d3ee99);
        color: #22d3ee;
        /* Elimina la rotación y escala */
        transform: none !important;
      }
      /* Espaciado premium para el contenido principal */
      .page-content {
        padding: 2.2rem 2.5rem 2.5rem 2.5rem;
        width: 100%;
        box-sizing: border-box;
        min-width: 0;
        margin: 0 auto;
        transition: padding 0.3s;
        overflow-x: auto;
      }
      @media (max-width: 1024px) {
        .page-content {
          padding: 1.2rem 1rem 1.5rem 1rem;
        }
      }
      @media (max-width: 640px) {
        .page-content {
          padding: 0.7rem 0.3rem 1rem 0.3rem;
        }
      }
      /* Elimina ajuste de max-width para evitar desplazamiento fuera de la página */
      .main-content.pushed .page-content,
      .header-content.pushed ~ .main-wrapper .main-content .page-content {
        width: 100%;
        max-width: 100vw;
      }
      /* Efecto premium animado para el icono del menú sidebar solo cuando está abierto */
      .sidebar-menu-animated {
        transform: scale(1.08) rotate(-4deg) !important;
        color: #22d3ee !important;
        filter: drop-shadow(0 0 8px #22d3ee99) !important;
        transition: transform 0.18s, color 0.18s, filter 0.18s;
      }
      /* Elimina la animación, solo color premium */
      .sidebar-menu-active {
        color: #22d3ee !important;
        filter: drop-shadow(0 0 8px #22d3ee99) !important;
        transition: color 0.18s, filter 0.18s;
      }
    </style>
    <title>{% block title %}AuraCare - Sistema Médico Profesional{% endblock %}</title>
    {% tailwind_css %}
</head>
<body style="min-height:100vh;display:flex;">
    {% if user.is_authenticated %}
    <!-- Sidebar Overlay (todas las resoluciones) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar(false)"></div>
    <!-- Sidebar Drawer universal -->
    <aside class="sidebar hide" id="sidebar" aria-label="Menú principal">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <span class="sidebar-logo-text">AuraCare</span>
            </div>
        </div>
        <nav class="sidebar-nav" aria-label="Navegación principal">
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Principal</h3>
                <a href="{% url 'home' %}" class="sidebar-link {% if request.path == '/' %}active{% endif %}" tabindex="0"><i class="fas fa-home"></i><span>Dashboard</span></a>
                <a href="{% url 'doctor:citas' %}" class="sidebar-link" tabindex="0"><i class="fas fa-calendar-alt"></i><span>Citas Médicas</span><span class="sidebar-badge">12</span></a>
                <a href="#" class="sidebar-link" tabindex="0"><i class="fas fa-user-injured"></i><span>Pacientes</span></a>
            </div>
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Atención Médica</h3>
                <a href="{% url 'doctor:atencion_list' %}" class="sidebar-link" tabindex="0"><i class="fas fa-stethoscope"></i><span>Consultas</span></a>
                <a href="#" class="sidebar-link" tabindex="0"><i class="fas fa-prescription-bottle-alt"></i><span>Recetas</span></a>
                <a href="#" class="sidebar-link" tabindex="0"><i class="fas fa-file-medical"></i><span>Historial Médico</span></a>
                <a href="#" class="sidebar-link" tabindex="0"><i class="fas fa-vial"></i><span>Laboratorio</span></a>
            </div>
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Administración</h3>
                <a href="{% url 'doctor:pago_list' %}" class="sidebar-link" tabindex="0"><i class="fas fa-chart-line"></i><span>Reportes</span></a>
                <a href="{% url 'core:gasto_mensual_list' %}" class="sidebar-link" tabindex="0"><i class="fas fa-wallet"></i><span>Finanzas</span></a>
                <a href="#" class="sidebar-link" tabindex="0"><i class="fas fa-cog"></i><span>Configuración</span></a>
            </div>
        </nav>
    </aside>
    {% endif %}
    <div class="main-wrapper">
        <!-- Header -->
        <header class="header" aria-label="Barra superior" id="mainHeader">
            <div class="header-content">
                <button class="header-button" id="sidebarMenuBtn" onclick="toggleSidebar(true)" aria-label="Abrir menú" style="margin-right:1.1rem;display:inline-flex;"><i class="fas fa-bars"></i></button>
                <div class="sidebar-logo" style="display:flex;align-items:center;gap:0.7rem;">
                    <div class="sidebar-logo-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <span class="sidebar-logo-text">AuraCare Médico</span>
                </div>
                {% if user.is_authenticated %}
                <div class="header-actions-fixed">
                    <select id="groupSelect" class="header-button group-select-premium" aria-label="Seleccionar grupo" style="margin-left:auto;">
                        <option value="">Seleccionar Grupo</option>
                        {% for group in group_list %}
                        <option value="{{ group.id }}" {% if request.GET.gpid == group.id|stringformat:"s" %}selected{% endif %}>{{ group.name }}</option>
                        {% endfor %}
                    </select>
                    <button class="header-button notification-btn-premium" aria-label="Notificaciones" style="margin-left:1.1rem;"><i class="fas fa-bell"></i><span class="notification-badge">3</span></button>
                    <div class="user-menu-premium" style="margin-left:1.1rem;">
                        <button class="user-button-premium" onclick="toggleUserDropdown()" aria-label="Menú de usuario">
                            <div class="user-avatar-premium">{{ user.username|first|upper }}</div>
                            <div class="user-info-premium">
                                <span class="user-name-premium">{{ user.username }}</span>
                                <span class="user-role-premium">{% if group_list.exists %}{{ group_list.first.name }}{% else %}Médico{% endif %}</span>
                            </div>
                            <i class="fas fa-chevron-down" id="userDropdownIcon"></i>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="dropdown-section">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div class="user-avatar-premium">{{ user.username|first|upper }}</div>
                                    <div>
                                        <div class="user-name-premium">{{ user.username }}</div>
                                        <div style="font-size: 0.75rem; color: #64748b;">{{ user.email|default:"Sin email" }}</div>
                                    </div>
                                </div>
                                {% if group_list.exists %}
                                <div style="background: #f1f5f9; padding: 0.5rem; border-radius: var(--radius-md); margin-top: 0.5rem;">
                                    <span style="font-size: 0.75rem; font-weight: 600; color: var(--primary-blue);">{{ group_list.first.name }}</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="dropdown-section">
                                <a href="#" class="dropdown-link"><i class="fas fa-user"></i><span>Mi Perfil</span></a>
                                <a href="#" class="dropdown-link"><i class="fas fa-cog"></i><span>Configuración</span></a>
                                <a href="#" class="dropdown-link"><i class="fas fa-shield-alt"></i><span>Seguridad</span></a>
                            </div>
                            <div class="dropdown-section">
                                <form method="POST" action="{% url 'security:signout' %}">{% csrf_token %}
                                    <button type="submit" class="dropdown-link danger" style="width: 100%; text-align: left;"><i class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                    <a href="{% url 'security:signin' %}" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i><span>Iniciar Sesión</span></a>
                {% endif %}
            </div>
        </header>
        <div class="main-wrapper" style="flex:1;min-width:0;display:flex;flex-direction:column;">
            <!-- Main Content -->
            <main class="main-content" id="mainContent" style="flex:1;min-width:0;padding-top:72px;">
                <div class="page-content">
                    {% block content %}{% endblock content %}
                </div>
            </main>
        </div>
    </div>
    <script>
      // Sidebar toggle universal (todas las resoluciones, solo overlay, sin push)
      function toggleSidebar(forceShow) {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        const headerContent = document.querySelector('.header-content');
        const sidebarMenuBtnIcons = document.querySelectorAll('#sidebarMenuBtn i');
        // Si no se pasa argumento, alternar
        let show;
        if (typeof forceShow === 'undefined') {
          show = !sidebar.classList.contains('show');
        } else {
          show = !!forceShow;
        }
        if (show) {
          sidebar.classList.remove('hide');
          sidebar.classList.add('show');
          overlay.classList.add('active');
          document.body.style.overflow = 'hidden';
          if(window.innerWidth > 1024 && headerContent) headerContent.classList.add('pushed');
          // Solo color premium al icono (sin animación)
          sidebarMenuBtnIcons.forEach(function(icon){
            icon.classList.add('sidebar-menu-active');
          });
        } else {
          sidebar.classList.remove('show');
          sidebar.classList.add('hide');
          overlay.classList.remove('active');
          document.body.style.overflow = 'auto';
          if(headerContent) headerContent.classList.remove('pushed');
          // Quita el color premium del icono inmediatamente
          sidebarMenuBtnIcons.forEach(function(icon){
            icon.classList.remove('sidebar-menu-active');
          });
        }
      }
      // Cambia el evento del botón para alternar
      document.addEventListener('DOMContentLoaded', function() {
        const sidebarMenuBtn = document.getElementById('sidebarMenuBtn');
        if (sidebarMenuBtn) {
          sidebarMenuBtn.onclick = function() { toggleSidebar(); };
        }
      });
      // Cerrar sidebar con ESC
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') toggleSidebar(false);
      });
      // User dropdown
      function toggleUserDropdown() {
        const dropdown = document.getElementById('userDropdown');
        dropdown.classList.toggle('show');
      }
      document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('userDropdown');
        if (dropdown && dropdown.classList.contains('show')) {
          const btn = document.querySelector('.user-button');
          if (!btn.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.remove('show');
          }
        }
      });
      // Ripple effect mejorado
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('button, .btn, .sidebar-link, .dropdown-link').forEach(el => {
          el.addEventListener('click', function(e) {
            if (el.disabled) return;
            const ripple = document.createElement('span');
            const rect = el.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height) * 1.2;
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.className = 'ripple';
            el.appendChild(ripple);
            setTimeout(() => ripple.remove(), 700);
          });
        });
        // Animación de entrada para sidebar y header
        const sidebar = document.getElementById('sidebar');
        if (sidebar) sidebar.style.animation = 'slideInRight 0.7s cubic-bezier(.4,2,.3,1)';
        const header = document.querySelector('.header');
        if (header) header.style.animation = 'slideInRight 0.7s cubic-bezier(.4,2,.3,1)';
        // Group select
        const groupSelect = document.getElementById('groupSelect');
        if (groupSelect) {
          groupSelect.addEventListener('change', function() {
            const selectedGroupId = this.value;
            if (selectedGroupId) {
              window.location.href = `{% url 'home' %}?gpid=${selectedGroupId}`;
            } else {
              window.location.href = `{% url 'home' %}`;
            }
          });
        }
      });
      window.addEventListener('resize', function() {
        const headerContent = document.querySelector('.header-content');
        const sidebar = document.getElementById('sidebar');
        if(headerContent && sidebar) {
          if(window.innerWidth > 1024 && sidebar.classList.contains('show')) {
            headerContent.classList.add('pushed');
          } else {
            headerContent.classList.remove('pushed');
          }
        }
      });
    </script>
    {% block css %}{% endblock css %}
    {% block js %}{% endblock js %}
</body>
</html>