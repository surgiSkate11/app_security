{% extends 'home.html' %}
<title>{% block title %}{{title}}{% endblock %}</title>
{% load static %}
{% block css %}
    <script src="https://cdn.tailwindcss.com"></script>
{%  endblock css %}
{% block content %}
<section class="bg-gray-50 min-h-screen">
   <!-- Header -->
   <!-- Navigation Tabs -->
    <nav class="bg-blue-100 shadow-lg sticky top-0 z-10">
        <div class="container mx-auto px-6">
            <div class="flex space-x-0">
                <button onclick="showTab('paciente')" id="tab-paciente" class="tab-button flex-1 py-4 px-6 text-center border-b-3 border-blue-500 text-blue-600 font-semibold transition-all duration-300 hover:bg-blue-50">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>Datos del Paciente</span>
                    </div>
                </button>
                <button onclick="showTab('consultas')" id="tab-consultas" class="tab-button flex-1 py-4 px-6 text-center border-b-3 border-transparent text-gray-500 font-semibold transition-all duration-300 hover:bg-gray-50 hover:text-gray-700">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>Consultas Anteriores</span>
                    </div>
                </button>
                <button onclick="showTab('atencion')" id="tab-atencion" class="tab-button flex-1 py-4 px-6 text-center border-b-3 border-transparent text-gray-500 font-semibold transition-all duration-300 hover:bg-gray-50 hover:text-gray-700">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <span>Atención Actual</span>
                    </div>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
     <!-- Datos del Paciente -->
        <div id="content-paciente" class="tab-content active">
            <!-- Selector de Paciente -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 card-hover transition-all duration-300">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    Selección de Paciente
                </h2>

                <div class="flex flex-col md:flex-row gap-4 items-end">
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Buscar y Seleccionar Paciente</label>
                        <select id="paciente-select" onchange="cargarDatosPaciente()" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-700">
                            <option value="">Seleccione un paciente...</option>
                            <option value="1">Vera, Erick - CI: 0923456789</option>
                            <option value="2">García, María Elena - CI: 0934567890</option>
                            <option value="3">López, Carlos Alberto - CI: 0945678901</option>
                            <option value="4">Rodríguez, Ana Sofía - CI: 0956789012</option>
                            <option value="5">Martínez, José Luis - CI: 0967890123</option>
                        </select>
                    </div>
                    <button onclick="mostrarFormularioNuevoPaciente()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-4 rounded-xl transition-colors duration-200 flex items-center space-x-2 font-semibold">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>Agregar Paciente</span>
                    </button>
                </div>
            </div>

            <!-- Contenido del Paciente -->
            <div id="datos-paciente-container" style="display: none;">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Información Personal -->
                    <div class="lg:col-span-1">
                        <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                            <div class="text-center mb-6">
                                <div id="paciente-avatar" class="w-24 h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                                    <span id="paciente-iniciales" class="text-white text-3xl font-bold">EV</span>
                                </div>
                                <h2 id="paciente-nombre" class="text-2xl font-bold text-gray-800">Erick Vera</h2>
                                <p class="text-gray-500">Paciente</p>
                            </div>

                            <div class="space-y-4">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                    <span id="paciente-telefono" class="text-gray-700">+593 999 123 456</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span id="paciente-direccion" class="text-gray-700">Guayaquil, Ecuador</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
                                    </svg>
                                    <span id="paciente-email" class="text-gray-700">erick.vera@email.com</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 0V6a2 2 0 012-2h4a2 2 0 012 2v1m-6 0h8m-9 0a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2V9a2 2 0 00-2-2H7z"></path>
                                    </svg>
                                    <span id="paciente-edad" class="text-gray-700">45 años</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V4a2 2 0 114 0v2m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"></path>
                                    </svg>
                                    <span id="paciente-cedula" class="text-gray-700">CI: 0923456789</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Historia Clínica -->
                    <div class="lg:col-span-2">
                        <div class="space-y-6">
                            <!-- Antecedentes Personales Patológicos -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                    </div>
                                    Antecedentes Personales Patológicos
                                </h3>
                                <div class="bg-red-50 p-4 rounded-xl border-l-4 border-red-400">
                                    <textarea id="antecedentes-personales" class="w-full p-3 border border-red-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-white"
                                              rows="3"
                                              placeholder="Ej.: Diabetes tipo 2, hipertensión, asma, etc.">Diabetes tipo 2 desde hace 8 años en tratamiento con Metformina. Hipertensión arterial controlada desde hace 5 años con Losartán 50mg.</textarea>
                                </div>
                            </div>

                            <!-- Antecedentes Quirúrgicos -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                                        </svg>
                                    </div>
                                    Antecedentes Quirúrgicos
                                </h3>
                                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-400">
                                    <textarea id="antecedentes-quirurgicos" class="w-full p-3 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"
                                              rows="3"
                                              placeholder="Ej.: Cirugías previas como apendicectomía, cesárea, etc.">Cesárea segmentaria (2010). Colecistectomía laparoscópica por colelitiasis (2018).</textarea>
                                </div>
                            </div>

                            <!-- Antecedentes Familiares -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                    </div>
                                    Antecedentes Familiares
                                </h3>
                                <div class="bg-green-50 p-4 rounded-xl border-l-4 border-green-400">
                                    <textarea id="antecedentes-familiares" class="w-full p-3 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white"
                                              rows="3"
                                              placeholder="Enfermedades hereditarias (padres, abuelos, hermanos)">Padre: Diabetes tipo 2. Madre: HTA. Hermana: Hipotiroidismo. Abuela materna: Enfermedad coronaria.</textarea>
                                </div>
                            </div>

                            <!-- Alergias -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                    </div>
                                    Alergias
                                </h3>
                                <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-yellow-400">
                                    <textarea id="alergias" class="w-full p-3 border border-yellow-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white"
                                              rows="2"
                                              placeholder="Ej.: Penicilina, mariscos, polvo, etc.">No reporta alergias conocidas</textarea>
                                </div>
                            </div>

                            <!-- Medicamentos Actuales -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                                        </svg>
                                    </div>
                                    Medicamentos Actuales
                                </h3>
                                <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-purple-400">
                                    <textarea id="medicamentos-actuales" class="w-full p-3 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white"
                                              rows="3"
                                              placeholder="Nombre, dosis y frecuencia. Ej.: Losartán 50mg diario">Metformina 850mg dos veces al día. Losartán 50mg una vez al día.</textarea>
                                </div>
                            </div>

                            <!-- Hábitos Tóxicos -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.618 5.984A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016zM12 9v2m0 4h.01"></path>
                                        </svg>
                                    </div>
                                    Hábitos Tóxicos o Perjudiciales
                                </h3>
                                <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-orange-400">
                                    <textarea id="habitos-toxicos" class="w-full p-3 border border-orange-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-white"
                                              rows="3"
                                              placeholder="Ej.: Tabaco, alcohol, drogas, sedentarismo, etc.">No fuma. Consume alcohol socialmente (fines de semana). Sedentarismo leve.</textarea>
                                </div>
                            </div>

                            <!-- Vacunas -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    Vacunas
                                </h3>
                                <div class="bg-teal-50 p-4 rounded-xl border-l-4 border-teal-400">
                                    <textarea id="vacunas" class="w-full p-3 border border-teal-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent bg-white"
                                              rows="2"
                                              placeholder="Vacunas importantes recibidas. Ej.: COVID-19, influenza, etc.">COVID-19 (esquema completo + refuerzo 2024). Influenza anual. Hepatitis B.</textarea>
                                </div>
                            </div>

                            <!-- Antecedentes Gineco-obstétricos -->
                            <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <div class="w-8 h-8 bg-pink-100 rounded-lg flex items-center justify-center mr-3">
                                        <svg class="w-4 h-4 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                        </svg>
                                    </div>
                                    Antecedentes Gineco-obstétricos
                                </h3>
                                <div class="bg-pink-50 p-4 rounded-xl border-l-4 border-pink-400">
                                    <textarea id="antecedentes-gineco" class="w-full p-3 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent bg-white"
                                              rows="3"
                                              placeholder="Información gineco-obstétrica relevante">Menarquia: 13 años. G2P2A0. Última menstruación: Regular. Método anticonceptivo: No usa actualmente.</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mensaje cuando no hay paciente seleccionado -->
            <div id="no-paciente-mensaje" class="text-center py-16">
                <div class="w-32 h-32 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">Seleccione un paciente</h3>
                <p class="text-gray-500">Para ver los datos del paciente, seleccione uno de la lista o agregue un nuevo paciente.</p>
            </div>

            <!-- Modal Agregar Paciente si no existe -->
            {% include "fragments/modal_paciente.html"  %}
        </div>
         <!-- Consultas Anteriores -->
        <div id="content-consultas" class="tab-content">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center">
                    <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    Historial de Consultas
                </h2>
                <p class="text-gray-600">Registro completo de atenciones médicas anteriores</p>
            </div>

            <div class="space-y-6">
                <!-- Consulta 1 -->
                <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300 border-l-4 border-blue-500">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
                            <h3 class="text-xl font-bold text-gray-800">15 de Junio, 2025</h3>
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Control</span>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Evaluación Clínica -->
                        <div class="lg:col-span-2 space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-blue-800 text-sm mb-2">Motivo de Consulta</h4>
                                    <p class="text-blue-700">Control rutinario diabetes tipo 2</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-purple-800 text-sm mb-2">Síntomas</h4>
                                    <p class="text-purple-700">Asintomático, control de rutina</p>
                                </div>
                            </div>

                            <div class="bg-green-50 p-4 rounded-xl">
                                <h4 class="font-semibold text-green-800 text-sm mb-2">Examen Físico</h4>
                                <p class="text-green-700">Paciente en buen estado general, abdomen blando, depresible, no doloroso. Extremidades sin edemas.</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-red-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-red-800 text-sm mb-2">Diagnósticos</h4>
                                    <p class="text-red-700">E11.9 - Diabetes tipo 2 sin complicaciones</p>
                                </div>
                                <div class="bg-cyan-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-cyan-800 text-sm mb-2">Plan de Tratamiento</h4>
                                    <p class="text-cyan-700">Continuar Metformina 850mg BID. Control en 3 meses.</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-yellow-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-yellow-800 text-sm mb-2">Exámenes Solicitados</h4>
                                    <p class="text-yellow-700">Glicemia en ayunas, HbA1c, perfil lipídico</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-gray-800 text-sm mb-2">Comentario Adicional</h4>
                                    <p class="text-gray-700">Paciente adherente al tratamiento</p>
                                </div>
                            </div>
                        </div>

                        <!-- Signos Vitales -->
                        <div class="lg:col-span-1">
                            <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl">
                                <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                                    <svg class="w-4 h-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                    Signos Vitales
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Presión Arterial:</span>
                                        <span class="font-semibold text-gray-800">120/80 mmHg</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Pulso:</span>
                                        <span class="font-semibold text-gray-800">72 ppm</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Temperatura:</span>
                                        <span class="font-semibold text-gray-800">36.5°C</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Freq. Respiratoria:</span>
                                        <span class="font-semibold text-gray-800">16 rpm</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Saturación O2:</span>
                                        <span class="font-semibold text-gray-800">98%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Peso:</span>
                                        <span class="font-semibold text-gray-800">70.5 kg</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Altura:</span>
                                        <span class="font-semibold text-gray-800">1.65 m</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consulta 2 -->
                <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300 border-l-4 border-green-500">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-green-500 rounded-full"></div>
                            <h3 class="text-xl font-bold text-gray-800">20 de Mayo, 2025</h3>
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Urgencia</span>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Evaluación Clínica -->
                        <div class="lg:col-span-2 space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-blue-800 text-sm mb-2">Motivo de Consulta</h4>
                                    <p class="text-blue-700">Dolor abdominal intenso de 6 horas de evolución</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-purple-800 text-sm mb-2">Síntomas</h4>
                                    <p class="text-purple-700">Dolor epigástrico, náuseas, sensación de llenura</p>
                                </div>
                            </div>

                            <div class="bg-green-50 p-4 rounded-xl">
                                <h4 class="font-semibold text-green-800 text-sm mb-2">Examen Físico</h4>
                                <p class="text-green-700">Abdomen blando, doloroso a la palpación en epigastrio, sin signos de irritación peritoneal.</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-red-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-red-800 text-sm mb-2">Diagnósticos</h4>
                                    <p class="text-red-700">K29.7 - Gastritis sin especificar</p>
                                </div>
                                <div class="bg-cyan-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-cyan-800 text-sm mb-2">Plan de Tratamiento</h4>
                                    <p class="text-cyan-700">Omeprazol 20mg QD x 14 días. Dieta blanda.</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-yellow-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-yellow-800 text-sm mb-2">Exámenes Solicitados</h4>
                                    <p class="text-yellow-700">Ecografía abdominal, Helicobacter pylori</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-gray-800 text-sm mb-2">Comentario Adicional</h4>
                                    <p class="text-gray-700">Control en 1 semana o antes si empeoran síntomas</p>
                                </div>
                            </div>
                        </div>

                        <!-- Signos Vitales -->
                        <div class="lg:col-span-1">
                            <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl">
                                <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                                    <svg class="w-4 h-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                    Signos Vitales
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Presión Arterial:</span>
                                        <span class="font-semibold text-gray-800">130/85 mmHg</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Pulso:</span>
                                        <span class="font-semibold text-gray-800">85 ppm</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Temperatura:</span>
                                        <span class="font-semibold text-gray-800">36.8°C</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Freq. Respiratoria:</span>
                                        <span class="font-semibold text-gray-800">18 rpm</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Saturación O2:</span>
                                        <span class="font-semibold text-gray-800">97%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Peso:</span>
                                        <span class="font-semibold text-gray-800">71.0 kg</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Altura:</span>
                                        <span class="font-semibold text-gray-800">1.65 m</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consulta 3 -->
                <div class="bg-white rounded-2xl shadow-xl p-8 card-hover transition-all duration-300 border-l-4 border-purple-500">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-purple-500 rounded-full"></div>
                            <h3 class="text-xl font-bold text-gray-800">10 de Abril, 2025</h3>
                            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">Chequeo</span>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Evaluación Clínica -->
                        <div class="lg:col-span-2 space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-blue-800 text-sm mb-2">Motivo de Consulta</h4>
                                    <p class="text-blue-700">Chequeo médico anual</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-purple-800 text-sm mb-2">Síntomas</h4>
                                    <p class="text-purple-700">Sin síntomas particulares</p>
                                </div>
                            </div>

                            <div class="bg-green-50 p-4 rounded-xl">
                                <h4 class="font-semibold text-green-800 text-sm mb-2">Examen Físico</h4>
                                <p class="text-green-700">Paciente en excelente estado general. Todos los sistemas dentro de normalidad.</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-red-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-red-800 text-sm mb-2">Diagnósticos</h4>
                                    <p class="text-red-700">Z00.0 - Examen médico general</p>
                                </div>
                                <div class="bg-cyan-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-cyan-800 text-sm mb-2">Plan de Tratamiento</h4>
                                    <p class="text-cyan-700">Mantener tratamiento actual. Control anual.</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-yellow-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-yellow-800 text-sm mb-2">Exámenes Solicitados</h4>
                                    <p class="text-yellow-700">Hemograma completo, química sanguínea, EKG</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-xl">
                                    <h4 class="font-semibold text-gray-800 text-sm mb-2">Comentario Adicional</h4>
                                    <p class="text-gray-700">Paciente en excelente estado de salud</p>
                                </div>
                            </div>
                        </div>

                        <!-- Signos Vitales -->
                        <div class="lg:col-span-1">
                            <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl">
                                <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                                    <svg class="w-4 h-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                    </svg>
                                    Signos Vitales
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Presión Arterial:</span>
                                        <span class="font-semibold text-gray-800">118/75 mmHg</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Pulso:</span>
                                        <span class="font-semibold text-gray-800">68 ppm</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Temperatura:</span>
                                        <span class="font-semibold text-gray-800">36.4°C</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Freq. Respiratoria:</span>
                                        <span class="font-semibold text-gray-800">14 rpm</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Saturación O2:</span>
                                        <span class="font-semibold text-gray-800">99%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Peso:</span>
                                        <span class="font-semibold text-gray-800">69.8 kg</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Altura:</span>
                                        <span class="font-semibold text-gray-800">1.65 m</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Atención Actual -->
         <div id="content-atencion" class="tab-content">
            <div class="space-y-8">
                <!-- Identificación -->
                <form id="atencion-form" onsubmit="event.preventDefault(); grabarAtencion();">

                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center mr-4">
                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                            </div>
                            Identificación de la Atención
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-blue-50 p-6 rounded-xl border-l-4 border-blue-400">
                                <h3 class="font-semibold text-blue-800 mb-2">Paciente</h3>
                                <p class="text-blue-700 text-lg">Vera, Erick</p>
                                <!-- Campo oculto para capturar ID del paciente -->
                                <input type="hidden" id="id_paciente" value="1">
                            </div>
                            <div class="bg-green-50 p-6 rounded-xl border-l-4 border-green-400">
                                <h3 class="font-semibold text-green-800 mb-2">Doctor Atendiente</h3>
                                <p class="text-green-700 text-lg">Arellano Oscar</p>
                                <!-- Campo oculto para capturar ID del doctor -->
                                <input type="hidden" id="id_doctor" value="1">
                            </div>
                        </div>
                    </div>

                    <!-- Signos Vitales -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </div>
                            Signos Vitales y Mediciones
                        </h3>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-red-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-red-800 text-sm">Presión Arterial</h4>
                                <input type="text" id="id_presion_arterial" class="w-full mt-2 p-2 border border-red-200 rounded-lg text-center font-bold text-red-700" placeholder="120/80">
                            </div>
                            <div class="bg-pink-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-pink-800 text-sm">Pulso (ppm)</h4>
                                <input type="number" id="id_pulso" class="w-full mt-2 p-2 border border-pink-200 rounded-lg text-center font-bold text-pink-700" placeholder="72">
                            </div>
                            <div class="bg-orange-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-orange-800 text-sm">Temperatura (°C)</h4>
                                <input type="number" step="0.1" id="id_temperatura" class="w-full mt-2 p-2 border border-orange-200 rounded-lg text-center font-bold text-orange-700" placeholder="36.5">
                            </div>
                            <div class="bg-blue-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-blue-800 text-sm">Freq. Respiratoria</h4>
                                <input type="number" id="id_frecuencia_respiratoria" class="w-full mt-2 p-2 border border-blue-200 rounded-lg text-center font-bold text-blue-700" placeholder="16">
                            </div>
                            <div class="bg-green-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-green-800 text-sm">Saturación O2 (%)</h4>
                                <input type="number" id="id_saturacion_oxigeno" class="w-full mt-2 p-2 border border-green-200 rounded-lg text-center font-bold text-green-700" placeholder="98">
                            </div>
                            <div class="bg-purple-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-purple-800 text-sm">Peso (kg)</h4>
                                <input type="number" step="0.1" id="id_peso" class="w-full mt-2 p-2 border border-purple-200 rounded-lg text-center font-bold text-purple-700" placeholder="70.5">
                            </div>
                            <div class="bg-indigo-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-indigo-800 text-sm">Altura (m)</h4>
                                <input type="number" step="0.01" id="id_altura" class="w-full mt-2 p-2 border border-indigo-200 rounded-lg text-center font-bold text-indigo-700" placeholder="1.75">
                            </div>
                            <div class="bg-teal-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-teal-800 text-sm mb-3">Consulta Control</h4>
                                <div class="flex items-center justify-center">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="id_consulta_control" class="sr-only">
                                        <div class="relative">
                                            <div class="w-10 h-6 bg-teal-200 rounded-full shadow-inner transition-colors duration-200 ease-in-out"></div>
                                            <div class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transform transition-transform duration-200 ease-in-out"></div>
                                        </div>
                                        <span class="ml-3 text-sm font-medium text-teal-700">¿Es consulta de control?</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Evaluación Clínica -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            Evaluación Clínica
                        </h3>

                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Motivo de Consulta *</label>
                                    <textarea id="id_motivo_consulta" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Ingrese el motivo de la consulta..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Síntomas *</label>
                                    <textarea id="id_sintomas" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Describa los síntomas presentados..."></textarea>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Examen Físico</label>
                                <textarea id="id_examen_fisico" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="4" placeholder="Hallazgos del examen físico..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Diagnósticos *</label>
                                <div class="bg-gray-50 p-4 rounded-xl">
                                    <div class="flex items-center space-x-3 mb-3">
                                        <input type="text" id="id_diagnostico_input" class="flex-1 p-3 border border-gray-300 rounded-lg" placeholder="CIE-10: R05 - Tos">
                                        <button type="button" onclick="agregarDiagnostico()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition-colors duration-200">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div id="diagnosticos-lista" class="text-sm text-gray-600">
                                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs mr-2 mb-2 inline-block">CIE-10: R05 - Tos
                                            <button onclick="this.parentElement.remove(); document.querySelector('#id_diagnostico option[value=&quot;R05&quot;]')?.remove()" class="ml-1 text-red-500 hover:text-red-700">×</button>
                                        </span>
                                    </div>
                                    <!-- Select múltiple oculto para enviar los diagnósticos -->
                                    <select id="id_diagnostico" multiple class="hidden">
                                        <option value="R05" selected>CIE-10: R05 - Tos</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Plan Terapéutico -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-cyan-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-4 h-4 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                </svg>
                            </div>
                            Plan Terapéutico
                        </h3>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Plan de Tratamiento *</label>
                                <textarea id="id_tratamiento" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="4" placeholder="Detalle el plan de tratamiento..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Exámenes Solicitados</label>
                                <textarea id="id_examenes_enviados" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Lista de exámenes solicitados..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Comentario Adicional</label>
                                <textarea id="id_comentario_adicional" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Comentarios adicionales..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Prescripción de Medicamentos -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-rose-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-4 h-4 text-rose-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                                </svg>
                            </div>
                            Prescripción de Medicamentos
                        </h3>

                        <!-- Formulario de agregar medicamento -->
                        <div class="bg-gray-50 p-6 rounded-xl mb-6">
                            <h4 class="font-semibold text-gray-800 mb-4">Agregar Medicamento</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Medicamento *</label>
                                    <select id="medicamento-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500">
                                        <option value="">Seleccione medicamento...</option>
                                        <option value="Paracetamol 500mg">Paracetamol 500mg</option>
                                        <option value="Ibuprofeno 400mg">Ibuprofeno 400mg</option>
                                        <option value="Amoxicilina 500mg">Amoxicilina 500mg</option>
                                        <option value="Metformina 850mg">Metformina 850mg</option>
                                        <option value="Losartán 50mg">Losartán 50mg</option>
                                        <option value="Omeprazol 20mg">Omeprazol 20mg</option>
                                        <option value="Atorvastatina 20mg">Atorvastatina 20mg</option>
                                        <option value="Aspirina 100mg">Aspirina 100mg</option>
                                        <option value="Enalapril 10mg">Enalapril 10mg</option>
                                        <option value="Simvastatina 40mg">Simvastatina 40mg</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cantidad *</label>
                                    <input type="number" id="cantidad-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="30">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Prescripción *</label>
                                    <input type="text" id="prescripcion-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="1 cada 8 horas">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Duración (días) *</label>
                                    <input type="number" id="duracion-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="7">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Frecuencia diaria *</label>
                                    <input type="number" id="frecuencia-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500" placeholder="3">
                                </div>
                            </div>
                            <div class="mt-4 flex space-x-3">
                                <button type="button" onclick="agregarMedicamento()" class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 flex items-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    <span>Agregar Medicamento</span>
                                </button>
                                <button type="button" onclick="verDatos()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors duration-200">
                                    Ver Datos
                                </button>
                            </div>
                        </div>

                        <!-- Tabla de medicamentos -->
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b-2 border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Medicamento</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Cantidad</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Prescripción</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Duración (días)</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Frecuencia</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Acción</th>
                                    </tr>
                                </thead>
                                <tbody id="medicamentos-table">
                                    <!-- Los medicamentos se agregarán aquí dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Botón de Guardar -->
                    <div class="bg-white rounded-2xl shadow-xl p-8 mt-8">
                        <div class="flex justify-center space-x-4">
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-colors duration-200 flex items-center space-x-3">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Guardar Atención Médica</span>
                            </button>
                            <button type="button" onclick="window.history.back()" class="bg-gray-600 hover:bg-gray-700 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-colors duration-200">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

    </main>

</section>

<!-- CSS para estilos de error y variables médicas -->
 <style>

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        main { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; animation: fadeIn 0.5s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card-hover:hover { transform: translateY(-4px); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .medical-gradient { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.9); }
        .card-hover:hover {
            transform: translateY(-4px);
        }
        /* Estilos adicionales para el modal de paciente */

        /* Animación de entrada del modal */
        #modal-agregar-paciente {
            animation: fadeIn 0.3s ease-out;
        }

        #modal-agregar-paciente .inline-block {
            animation: slideInDown 0.3s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translate3d(0, -100%, 0);
            }
            to {
                opacity: 1;
                transform: translateZ(0);
            }
        }

        /* Estilos para el scroll del modal */
        #modal-agregar-paciente {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Altura máxima para dispositivos móviles */
        @media (max-height: 600px) {
            #modal-agregar-paciente .inline-block {
                margin: 1rem 0;
            }
        }

        /* Estilos para inputs focus mejorados */
        .focus\:ring-2:focus {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }

        .focus\:ring-green-500:focus {
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.5);
        }

        /* Transición suave para acordeón */
        #content-datos-personales,
        #content-historia-clinica {
            transition: all 0.3s ease-in-out;
        }

        /* Estilos para validación de campos */
        .campo-error {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }

        .campo-error:focus {
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.5) !important;
        }

        /* Estilos para campos obligatorios */
        input[required]:invalid {
            border-color: #fbbf24;
        }

        input[required]:valid {
            border-color: #10b981;
        }

        /* Hover effect mejorado para botones del acordeón */
        .hover\:bg-blue-100:hover {
            background-color: #dbeafe;
        }

        .hover\:bg-green-100:hover {
            background-color: #dcfce7;
        }

        /* Estilos responsivos para el modal */
        @media (max-width: 768px) {
            #modal-agregar-paciente .inline-block {
                margin: 0.5rem;
                width: calc(100% - 1rem);
            }

            #modal-agregar-paciente .grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }

        /* Indicador visual para campos obligatorios */
        label:has(+ input[required])::after,
        label:has(+ select[required])::after {
            content: ' *';
            color: #ef4444;
        }

        /* Estilos para el upload de archivos */
        input[type="file"] {
            padding: 0.5rem !important;
        }

        input[type="file"]::-webkit-file-upload-button {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            margin-right: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        input[type="file"]::-webkit-file-upload-button:hover {
            background: #e5e7eb;
        }

        /* Estilos para textarea resize */
        textarea {
            resize: vertical;
            min-height: 2.5rem;
        }

        /* Animación de rotación para iconos del acordeón */
        .transform.rotate-180 {
            transform: rotate(180deg);
        }

        .transition-transform {
            transition: transform 0.2s ease-in-out;
        }

        /* Backdrop blur para el modal */
        #modal-agregar-paciente > .flex > .fixed {
            backdrop-filter: blur(4px);
        }

        /* Scroll personalizado para el modal */
        #modal-agregar-paciente::-webkit-scrollbar {
            width: 8px;
        }

        #modal-agregar-paciente::-webkit-scrollbar-track {
            background: transparent;
        }

        #modal-agregar-paciente::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
            border-radius: 4px;
        }

        #modal-agregar-paciente::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.7);
        }
        /* Estilos para el checkbox toggle */
        input[type="checkbox"]:checked + div .bg-teal-200 {
            background-color: #14b8a6; /* teal-500 */
        }

        input[type="checkbox"]:checked + div .transform {
            transform: translateX(1rem); /* Mueve el círculo a la derecha */
        }

        input[type="checkbox"]:focus + div {
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.3);
            border-radius: 9999px;
        }

        /* Hover effect */
        label:hover .bg-teal-200 {
            background-color: #99f6e4; /* teal-300 */
        }

        input[type="checkbox"]:checked + div:hover .bg-teal-200 {
            background-color: #0d9488; /* teal-600 */
        }
 </style>

 <script>
        // Variables globales
        //let medicamentos = [];

        // Función para cambiar de pestaña o tabs
        function showTab(tabName) {
            // Ocultar todas las pestañas
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar la pestaña seleccionada
            const selectedTab = document.getElementById('content-' + tabName);
            selectedTab.classList.add('active');

            // Actualizar estilos de los botones
            const allButtons = document.querySelectorAll('.tab-button');
            allButtons.forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600');
                button.classList.add('border-transparent', 'text-gray-500');
            });

            // Activar el botón seleccionado
            const selectedButton = document.getElementById('tab-' + tabName);
            selectedButton.classList.remove('border-transparent', 'text-gray-500');
            selectedButton.classList.add('border-blue-500', 'text-blue-600');
        }

        // Clase para procesar la atencion con sus medicamentos
     // ==============================
// CLASE PRINCIPAL - VERSIÓN CORREGIDA
// ==============================
class GestorAtencionMedica {
    constructor() {
        console.log('🔧 Construyendo GestorAtencionMedica...');

        // Inicializar arrays para medicamentos
        this.medicamentos = [];

        // Propiedades para capturar datos del formulario
        this.paciente = '';
        this.presionArterial = '';
        this.pulso = '';
        this.temperatura = '';
        this.frecuenciaRespiratoria = '';
        this.saturacionOxigeno = '';
        this.peso = '';
        this.altura = '';
        this.consultaControl = false;
        this.motivoConsulta = '';
        this.sintomas = '';
        this.examenFisico = '';
        this.diagnostico = [];
        this.tratamiento = '';
        this.examenesEnviados = '';
        this.comentarioAdicional = '';

        console.log('✅ GestorAtencionMedica construido exitosamente');
    }

    // ============================================
    // 🛡️ MÉTODOS DE VERIFICACIÓN SEGUROS
    // ============================================

    // Método seguro para obtener elemento por ID
    obtenerElementoSeguro(id) {
        const elemento = document.getElementById(id);
        if (!elemento) {
            console.warn(`⚠️ Elemento no encontrado: ${id}`);
        }
        return elemento;
    }

    // Método seguro para obtener valor de un elemento
    obtenerValorSeguro(id, valorPorDefecto = '') {
        const elemento = this.obtenerElementoSeguro(id);
        return elemento ? elemento.value : valorPorDefecto;
    }

    // Método seguro para verificar checkbox
    obtenerCheckboxSeguro(id) {
        const elemento = this.obtenerElementoSeguro(id);
        return elemento ? elemento.checked : false;
    }

    // ============================================
    // 💊 GESTIÓN DE MEDICAMENTOS
    // ============================================

    // Método para agregar medicamento a la tabla
    agregarMedicamento() {
        console.log('💊 Agregando medicamento...');

        // Obtener valores de los campos de forma segura
        const medicamento = this.obtenerValorSeguro('medicamento-select');
        const cantidad = this.obtenerValorSeguro('cantidad-input');
        const prescripcion = this.obtenerValorSeguro('prescripcion-input');
        const duracion = this.obtenerValorSeguro('duracion-input');
        const frecuencia = this.obtenerValorSeguro('frecuencia-input');

        console.log('📋 Valores capturados:', {medicamento, cantidad, prescripcion, duracion, frecuencia});

        // Validar que todos los campos estén llenos
        if (!medicamento || !cantidad || !prescripcion || !duracion || !frecuencia) {
            alert('Por favor, complete todos los campos obligatorios del medicamento.');
            return;
        }

        // Validar que los números sean válidos
        if (isNaN(cantidad) || isNaN(duracion) || isNaN(frecuencia)) {
            alert('La cantidad, duración y frecuencia deben ser números válidos.');
            return;
        }

        // Crear objeto medicamento
        const nuevoMedicamento = {
            id: this.medicamentos.length + 1,
            medicamento: medicamento,
            cantidad: parseInt(cantidad),
            prescripcion: prescripcion,
            duracion: parseInt(duracion),
            frecuencia: parseInt(frecuencia)
        };

        // Agregar a la lista
        this.medicamentos.push(nuevoMedicamento);

        // Actualizar la tabla
        this.actualizarTablaMedicamentos();

        // Limpiar campos
        this.limpiarCamposMedicamentos();

        console.log('✅ Medicamento agregado:', nuevoMedicamento);
        console.log('📊 Total medicamentos:', this.medicamentos.length);
    }

    // Método para actualizar la tabla de medicamentos
    actualizarTablaMedicamentos() {
        console.log('🔄 Actualizando tabla de medicamentos...');

        const tbody = this.obtenerElementoSeguro('medicamentos-table');

        if (!tbody) {
            console.error('❌ No se encontró la tabla con ID: medicamentos-table');
            return;
        }

        // Limpiar tabla
        tbody.innerHTML = '';

        // Agregar cada medicamento
        this.medicamentos.forEach((med, index) => {
            const fila = document.createElement('tr');
            fila.className = 'border-b border-gray-100 hover:bg-gray-50';

            fila.innerHTML = `
                <td class="py-4 px-4 text-gray-800">${med.medicamento}</td>
                <td class="py-4 px-4 text-gray-600">${med.cantidad}</td>
                <td class="py-4 px-4 text-gray-600">${med.prescripcion}</td>
                <td class="py-4 px-4 text-gray-600">${med.duracion}</td>
                <td class="py-4 px-4 text-gray-600">${med.frecuencia}</td>
                <td class="py-4 px-4">
                    <button onclick="eliminarMedicamentoSeguro(${index})"
                            class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors duration-200">
                        Eliminar
                    </button>
                </td>
            `;

            tbody.appendChild(fila);
        });

        console.log('✅ Tabla actualizada. Total medicamentos:', this.medicamentos.length);
    }

    // Método para limpiar campos de medicamentos
    limpiarCamposMedicamentos() {
        const campos = ['medicamento-select', 'cantidad-input', 'prescripcion-input', 'duracion-input', 'frecuencia-input'];

        campos.forEach(id => {
            const elemento = this.obtenerElementoSeguro(id);
            if (elemento) {
                elemento.value = '';
            }
        });
    }

    // Método para eliminar medicamento
    eliminarMedicamento(index) {
        if (confirm('¿Está seguro de que desea eliminar este medicamento?')) {
            this.medicamentos.splice(index, 1);
            this.actualizarTablaMedicamentos();
            console.log('🗑️ Medicamento eliminado. Total restante:', this.medicamentos.length);
        }
    }

    // ============================================
    // 🩺 GESTIÓN DE DIAGNÓSTICOS
    // ============================================

    // Método para agregar diagnóstico
    agregarDiagnostico() {
        const diagnosticoInput = this.obtenerElementoSeguro('id_diagnostico_input');
        const diagnosticoSelect = this.obtenerElementoSeguro('id_diagnostico');
        const diagnosticoLista = this.obtenerElementoSeguro('diagnosticos-lista');

        if (!diagnosticoInput || !diagnosticoSelect || !diagnosticoLista) {
            console.error('❌ No se encontraron los elementos de diagnóstico');
            alert('Error: Elementos de diagnóstico no encontrados en la página');
            return;
        }

        const nuevoDiagnostico = diagnosticoInput.value.trim();

        if (!nuevoDiagnostico) {
            alert('Por favor, ingrese un diagnóstico.');
            return;
        }

        // Crear nueva opción en el select
        const option = document.createElement('option');
        option.value = nuevoDiagnostico;
        option.text = nuevoDiagnostico;
        option.selected = true;
        diagnosticoSelect.appendChild(option);

        // Agregar span visual en la lista
        const span = document.createElement('span');
        span.className = 'bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs mr-2 mb-2 inline-block';
        span.textContent = nuevoDiagnostico;

        // Agregar botón de eliminar
        const btnEliminar = document.createElement('button');
        btnEliminar.innerHTML = '×';
        btnEliminar.className = 'ml-1 text-red-500 hover:text-red-700';
        btnEliminar.onclick = () => {
            span.remove();
            option.remove();
        };
        span.appendChild(btnEliminar);

        diagnosticoLista.appendChild(span);

        // Limpiar input
        diagnosticoInput.value = '';

        console.log('✅ Diagnóstico agregado:', nuevoDiagnostico);
    }

    // ============================================
    // 💾 GRABACIÓN Y ENVÍO DE DATOS
    // ============================================

    // Método para capturar todos los datos del formulario
    grabarAtencion() {
        console.log('💾 Iniciando proceso de grabación...');

        try {
            // Capturar datos de identificación
            this.paciente = this.obtenerValorSeguro('id_paciente', '1');

            // Capturar signos vitales y mediciones
            this.presionArterial = this.obtenerValorSeguro('id_presion_arterial');
            this.pulso = this.obtenerValorSeguro('id_pulso');
            this.temperatura = this.obtenerValorSeguro('id_temperatura');
            this.frecuenciaRespiratoria = this.obtenerValorSeguro('id_frecuencia_respiratoria');
            this.saturacionOxigeno = this.obtenerValorSeguro('id_saturacion_oxigeno');
            this.peso = this.obtenerValorSeguro('id_peso');
            this.altura = this.obtenerValorSeguro('id_altura');
            this.consultaControl = this.obtenerCheckboxSeguro('id_consulta_control');

            // Capturar evaluación clínica
            this.motivoConsulta = this.obtenerValorSeguro('id_motivo_consulta');
            this.sintomas = this.obtenerValorSeguro('id_sintomas');
            this.examenFisico = this.obtenerValorSeguro('id_examen_fisico');

            // Capturar diagnósticos
            this.diagnostico = [];
            const diagnosticoElement = this.obtenerElementoSeguro("id_diagnostico");
            if (diagnosticoElement && diagnosticoElement.selectedOptions) {
                for (let option of diagnosticoElement.selectedOptions) {
                    this.diagnostico.push(option.value);
                }
            }

            // Capturar plan terapéutico
            this.tratamiento = this.obtenerValorSeguro('id_tratamiento');
            this.examenesEnviados = this.obtenerValorSeguro('id_examenes_enviados');
            this.comentarioAdicional = this.obtenerValorSeguro('id_comentario_adicional');

            // Validar campos obligatorios
            const errores = this.validarCamposObligatorios();
            if (errores.length > 0) {
                alert('Por favor, complete los siguientes campos obligatorios:\n' + errores.join('\n'));
                return;
            }

            // Preparar objeto con todos los datos
            const datosAtencion = this.obtenerDatosCompletos();
            console.log('📦 Datos preparados para envío:', datosAtencion);

            // Enviar datos al backend
            this.enviarDatosAlBackend(datosAtencion);

            console.log('✅ Proceso de grabación iniciado');

        } catch (error) {
            console.error('❌ Error en grabarAtencion:', error);
            alert('Error al procesar los datos: ' + error.message);
        }
    }

    // ============================================
    // 🚀 ENVÍO AL BACKEND
    // ============================================

    // Método para enviar datos al backend usando fetch
    async enviarDatosAlBackend(datos) {
        try {
            // Mostrar indicador de carga
            this.mostrarIndicadorCarga(true);

            // URL del endpoint - CAMBIAR POR TU URL REAL
            const url = '/api/atencion-medica';

            console.log('🚀 EJECUTANDO FETCH - Enviando datos al backend...');
            console.log('📍 URL:', url);
            console.log('📦 Datos a enviar:', datos);
            return
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(datos)
            });

            // Ocultar indicador de carga
            this.mostrarIndicadorCarga(false);

            if (response.ok) {
                const resultado = await response.json();
                console.log('✅ FETCH EXITOSO - Respuesta del servidor:', resultado);

                this.mostrarMensajeExito(resultado);
                this.limpiarFormulario();

            } else {
                const error = await response.text();
                console.error('❌ FETCH ERROR - Error del servidor:', response.status, error);
                this.mostrarMensajeError(`Error del servidor (${response.status}): ${error}`);
            }

        } catch (error) {
            this.mostrarIndicadorCarga(false);
            console.error('❌ FETCH FALLÓ - Error de conexión:', error);

            if (error instanceof TypeError && error.message.includes('fetch')) {
                console.log('🔌 Sin conexión - Ofreciendo modo offline...');
                this.manejarErrorConexion(datos);
            } else {
                this.mostrarMensajeError('Error inesperado: ' + error.message);
            }
        }
    }

    // Método para mostrar indicador de carga
    mostrarIndicadorCarga(mostrar) {
        const botonGuardar = document.querySelector('button[type="submit"]');

        if (!botonGuardar) {
            console.warn('⚠️ Botón de guardar no encontrado');
            return;
        }

        if (mostrar) {
            botonGuardar.disabled = true;
            botonGuardar.innerHTML = `
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Guardando...
            `;
        } else {
            botonGuardar.disabled = false;
            botonGuardar.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Guardar Atención Médica</span>
            `;
        }
    }

    // Método para mostrar mensaje de éxito
    mostrarMensajeExito(resultado) {
        const mensaje = resultado.message || 'Atención médica guardada exitosamente';
        const id = resultado.id || 'N/A';

        alert(`✅ ${mensaje}\n\n` +
              `ID de Atención: ${id}\n` +
              `Medicamentos: ${this.medicamentos.length}\n` +
              `Diagnósticos: ${this.diagnostico.length}\n` +
              `Fecha: ${new Date().toLocaleString()}`);
    }

    // Método para mostrar mensaje de error
    mostrarMensajeError(mensaje) {
        alert(`❌ Error al guardar:\n\n${mensaje}\n\nRevise la conexión e intente nuevamente.`);
    }

    // Método para manejar errores de conexión
    manejarErrorConexion(datos) {
        const guardarOffline = confirm(
            '❌ No se pudo conectar con el servidor.\n\n' +
            '¿Desea guardar los datos localmente?\n\n' +
            '(Los datos se enviarán cuando se restaure la conexión)'
        );

        if (guardarOffline) {
            this.guardarDatosOffline(datos);
            alert('💾 Datos guardados localmente.\n\nSe enviarán automáticamente cuando se restaure la conexión.');
        }
    }

    // Método para guardar datos offline
    guardarDatosOffline(datos) {
        try {
            const datosOffline = JSON.parse(localStorage.getItem('atencionesOffline') || '[]');
            datosOffline.push({
                ...datos,
                fechaGuardadoOffline: new Date().toISOString(),
                id_temporal: 'offline_' + Date.now()
            });
            localStorage.setItem('atencionesOffline', JSON.stringify(datosOffline));
            console.log('💾 Datos guardados offline:', datos);
        } catch (error) {
            console.error('❌ Error al guardar offline:', error);
        }
    }

    // ============================================
    // 🧹 UTILIDADES
    // ============================================

    // Método para limpiar el formulario
    limpiarFormulario() {
        const campos = [
            'id_presion_arterial', 'id_pulso', 'id_temperatura', 'id_frecuencia_respiratoria',
            'id_saturacion_oxigeno', 'id_peso', 'id_altura', 'id_motivo_consulta',
            'id_sintomas', 'id_examen_fisico', 'id_tratamiento', 'id_examenes_enviados',
            'id_comentario_adicional'
        ];

        campos.forEach(id => {
            const elemento = this.obtenerElementoSeguro(id);
            if (elemento) {
                elemento.value = '';
            }
        });

        // Limpiar checkbox
        const checkbox = this.obtenerElementoSeguro('id_consulta_control');
        if (checkbox) {
            checkbox.checked = false;
        }

        // Limpiar diagnósticos
        const diagnosticoLista = this.obtenerElementoSeguro('diagnosticos-lista');
        const diagnosticoSelect = this.obtenerElementoSeguro('id_diagnostico');

        if (diagnosticoLista) diagnosticoLista.innerHTML = '';
        if (diagnosticoSelect) diagnosticoSelect.innerHTML = '';

        // Limpiar medicamentos
        this.medicamentos = [];
        this.actualizarTablaMedicamentos();

        console.log('🧹 Formulario limpiado');
    }

    // Método para validar campos obligatorios
    validarCamposObligatorios() {
        const errores = [];

        if (!this.motivoConsulta.trim()) errores.push('- Motivo de Consulta');
        if (!this.sintomas.trim()) errores.push('- Síntomas');
        if (this.diagnostico.length === 0) errores.push('- Diagnósticos');
        if (!this.tratamiento.trim()) errores.push('- Plan de Tratamiento');

        return errores;
    }

    // Método para obtener todos los datos estructurados
    obtenerDatosCompletos() {
        return {
            paciente: this.paciente,
            signosVitales: {
                presionArterial: this.presionArterial,
                pulso: this.pulso,
                temperatura: this.temperatura,
                frecuenciaRespiratoria: this.frecuenciaRespiratoria,
                saturacionOxigeno: this.saturacionOxigeno,
                peso: this.peso,
                altura: this.altura,
                consultaControl: this.consultaControl
            },
            evaluacionClinica: {
                motivoConsulta: this.motivoConsulta,
                sintomas: this.sintomas,
                examenFisico: this.examenFisico,
                diagnostico: this.diagnostico
            },
            planTerapeutico: {
                tratamiento: this.tratamiento,
                examenesEnviados: this.examenesEnviados,
                comentarioAdicional: this.comentarioAdicional
            },
            medicamentos: this.medicamentos,
            fechaAtencion: new Date().toISOString(),
            totalMedicamentos: this.medicamentos.length,
            totalDiagnosticos: this.diagnostico.length
        };
    }

    // Método para mostrar datos
    verDatos() {
        console.log('=== DATOS ACTUALES ===');
        console.log('Medicamentos:', this.medicamentos);
        console.log('Datos completos:', this.obtenerDatosCompletos());
        alert('Ver datos en la consola del navegador (F12)');
    }
}

// ==============================
// FUNCIONES GLOBALES SEGURAS
// ==============================

// Variable global para la instancia
let atencionMedica = null;

// Función para inicializar de forma segura
function inicializarAtencion() {
    try {
        console.log('🔄 Intentando inicializar el sistema...');
        atencionMedica = new GestorAtencionMedica();
        console.log('✅ Sistema de atención médica inicializado correctamente');
        console.log('📋 Instancia creada:', atencionMedica);
        return true;
    } catch (error) {
        console.error('❌ Error al inicializar:', error);
        alert('Error al inicializar el sistema: ' + error.message);
        return false;
    }
}

// Funciones globales seguras
function agregarMedicamento() {
    console.log('🔄 Función agregarMedicamento() llamada');

    if (!atencionMedica) {
        console.log('⚠️ Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    try {
        atencionMedica.agregarMedicamento();
    } catch (error) {
        console.error('❌ Error en agregarMedicamento:', error);
        alert('Error al agregar medicamento: ' + error.message);
    }
}

function eliminarMedicamentoSeguro(index) {
    if (atencionMedica) {
        atencionMedica.eliminarMedicamento(index);
    } else {
        console.error('❌ Sistema no inicializado');
    }
}

function grabarAtencion() {
    console.log('🔄 Función grabarAtencion() llamada');

    if (!atencionMedica) {
        console.log('⚠️ Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    try {
        atencionMedica.grabarAtencion();
    } catch (error) {
        console.error('❌ Error en grabarAtencion:', error);
        alert('Error al grabar atención: ' + error.message);
    }
}

function agregarDiagnostico() {
    console.log('🔄 Función agregarDiagnostico() llamada');

    if (!atencionMedica) {
        console.log('⚠️ Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    try {
        atencionMedica.agregarDiagnostico();
    } catch (error) {
        console.error('❌ Error en agregarDiagnostico:', error);
        alert('Error al agregar diagnóstico: ' + error.message);
    }
}

function verDatos() {
    if (!atencionMedica) {
        console.log('⚠️ Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    atencionMedica.verDatos();
}

function verificarSistema() {
    console.log('🔍 Estado del sistema:');
    console.log('   atencionMedica:', atencionMedica);
    console.log('   Tipo:', typeof atencionMedica);
    console.log('   DOM ready:', document.readyState);
    return atencionMedica !== null;
}

        // Fin de la clase de medicamentos

        // Datos de ejemplo de pacientes
        const pacientesData = {
        "1": {
            nombres: "Erick",
            apellidos: "Vera",
            cedula: "0923456789",
            telefono: "+593 999 123 456",
            email: "erick.vera@email.com",
            direccion: "Guayaquil, Ecuador",
            edad: "45 años",
            antecedentesPersonales: "Diabetes tipo 2 desde hace 8 años en tratamiento con Metformina. Hipertensión arterial controlada desde hace 5 años con Losartán 50mg.",
            antecedentesQuirurgicos: "Cesárea segmentaria (2010). Colecistectomía laparoscópica por colelitiasis (2018).",
            antecedentesFamiliares: "Padre: Diabetes tipo 2. Madre: HTA. Hermana: Hipotiroidismo. Abuela materna: Enfermedad coronaria.",
            alergias: "No reporta alergias conocidas",
            medicamentosActuales: "Metformina 850mg dos veces al día. Losartán 50mg una vez al día.",
            habitosToxicos: "No fuma. Consume alcohol socialmente (fines de semana). Sedentarismo leve.",
            vacunas: "COVID-19 (esquema completo + refuerzo 2024). Influenza anual. Hepatitis B.",
            antecedentesGineco: "Menarquia: 13 años. G2P2A0. Última menstruación: Regular. Método anticonceptivo: No usa actualmente."
        },
        "2": {
            nombres: "María Elena",
            apellidos: "García",
            cedula: "0934567890",
            telefono: "+593 987 654 321",
            email: "maria.garcia@email.com",
            direccion: "Quito, Ecuador",
            edad: "32 años",
            antecedentesPersonales: "Hipotiroidismo en tratamiento con Levotiroxina. Migrañas ocasionales.",
            antecedentesQuirurgicos: "Apendicectomía (2015).",
            antecedentesFamiliares: "Madre: Hipotiroidismo. Padre: Hipertensión arterial.",
            alergias: "Alergia a la penicilina",
            medicamentosActuales: "Levotiroxina 50mcg en ayunas diariamente.",
            habitosToxicos: "No fuma. No consume alcohol. Actividad física regular.",
            vacunas: "COVID-19 (esquema completo). Influenza anual.",
            antecedentesGineco: "Menarquia: 12 años. G0P0A0. Ciclos regulares. Usa anticonceptivos orales."
        },
        "3": {
            nombres: "Carlos Alberto",
            apellidos: "López",
            cedula: "0945678901",
            telefono: "+593 976 543 210",
            email: "carlos.lopez@email.com",
            direccion: "Cuenca, Ecuador",
            edad: "58 años",
            antecedentesPersonales: "Hipertensión arterial. Dislipidemia en tratamiento.",
            antecedentesQuirurgicos: "Hernioplastia inguinal (2020).",
            antecedentesFamiliares: "Padre: Infarto agudo de miocardio. Madre: Diabetes tipo 2.",
            alergias: "No reporta alergias conocidas",
            medicamentosActuales: "Enalapril 10mg BID. Atorvastatina 20mg nocturno.",
            habitosToxicos: "Ex fumador (dejó hace 5 años). Consume alcohol ocasionalmente.",
            vacunas: "COVID-19 (esquema completo + 2 refuerzos). Influenza anual.",
            antecedentesGineco: "N/A"
        },
        "4": {
            nombres: "Ana Sofía",
            apellidos: "Rodríguez",
            cedula: "0956789012",
            telefono: "+593 965 432 109",
            email: "ana.rodriguez@email.com",
            direccion: "Ambato, Ecuador",
            edad: "28 años",
            antecedentesPersonales: "Asma bronquial desde la infancia. Rinitis alérgica.",
            antecedentesQuirurgicos: "Ninguna",
            antecedentesFamiliares: "Madre: Asma. Padre: Sin antecedentes relevantes.",
            alergias: "Alergia al polen y ácaros del polvo",
            medicamentosActuales: "Salbutamol inhalador PRN. Loratadina 10mg diario en época de alergias.",
            habitosToxicos: "No fuma. No consume alcohol. Practica yoga regularmente.",
            vacunas: "COVID-19 (esquema completo). Influenza anual.",
            antecedentesGineco: "Menarquia: 13 años. G0P0A0. Ciclos regulares. No usa anticonceptivos."
        },
        "5": {
            nombres: "José Luis",
            apellidos: "Martínez",
            cedula: "0967890123",
            telefono: "+593 954 321 098",
            email: "jose.martinez@email.com",
            direccion: "Machala, Ecuador",
            edad: "41 años",
            antecedentesPersonales: "Gastritis crónica. Sobrepeso.",
            antecedentesQuirurgicos: "Colecistectomía laparoscópica (2019).",
            antecedentesFamiliares: "Padre: Diabetes tipo 2. Madre: Hipertensión arterial.",
            alergias: "No reporta alergias conocidas",
            medicamentosActuales: "Omeprazol 20mg en ayunas. Metformina 500mg BID.",
            habitosToxicos: "No fuma. Consume alcohol socialmente. Sedentarismo.",
            vacunas: "COVID-19 (esquema completo + 1 refuerzo). Hepatitis B.",
            antecedentesGineco: "N/A"
        }
    };

    // Función para cargar datos del paciente seleccionado
        function cargarDatosPaciente() {
            const pacienteId = document.getElementById('paciente-select').value;
            const containerDatos = document.getElementById('datos-paciente-container');
            const noMensaje = document.getElementById('no-paciente-mensaje');

            if (pacienteId && pacientesData[pacienteId]) {
                const paciente = pacientesData[pacienteId];

                // Actualizar información personal
                document.getElementById('paciente-iniciales').textContent =
                    paciente.nombres.charAt(0) + paciente.apellidos.charAt(0);
                document.getElementById('paciente-nombre').textContent =
                    paciente.nombres + ' ' + paciente.apellidos;
                document.getElementById('paciente-telefono').textContent = paciente.telefono;
                document.getElementById('paciente-direccion').textContent = paciente.direccion;
                document.getElementById('paciente-email').textContent = paciente.email;
                document.getElementById('paciente-edad').textContent = paciente.edad;
                document.getElementById('paciente-cedula').textContent = 'CI: ' + paciente.cedula;

                // Actualizar historia clínica
                document.getElementById('antecedentes-personales').value = paciente.antecedentesPersonales;
                document.getElementById('antecedentes-quirurgicos').value = paciente.antecedentesQuirurgicos;
                document.getElementById('antecedentes-familiares').value = paciente.antecedentesFamiliares;
                document.getElementById('alergias').value = paciente.alergias;
                document.getElementById('medicamentos-actuales').value = paciente.medicamentosActuales;
                document.getElementById('habitos-toxicos').value = paciente.habitosToxicos;
                document.getElementById('vacunas').value = paciente.vacunas;
                document.getElementById('antecedentes-gineco').value = paciente.antecedentesGineco;

                // Mostrar contenedor de datos y ocultar mensaje
                containerDatos.style.display = 'block';
                noMensaje.style.display = 'none';
            } else {
                // Ocultar contenedor de datos y mostrar mensaje
                containerDatos.style.display = 'none';
                noMensaje.style.display = 'block';
            }
        }
        // fin del select paciente

        
        // Función para mostrar formulario de nuevo paciente (reemplazar la función existente)
        function mostrarFormularioNuevoPaciente() {
            document.getElementById('modal-agregar-paciente').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevenir scroll del body
        }

        // Función para cerrar modal
        function cerrarModalPaciente() {
            document.getElementById('modal-agregar-paciente').classList.add('hidden');
            document.body.style.overflow = 'auto'; // Restaurar scroll del body
            document.getElementById('form-nuevo-paciente').reset(); // Limpiar formulario
        }

        // Función para toggle del acordeón
        function toggleAccordion(section) {
            const content = document.getElementById(`content-${section}`);
            const icon = document.getElementById(`icon-${section}`);

            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.remove('rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.add('rotate-180');
            }
        }

        // Función para manejar el envío del formulario
        document.getElementById('form-nuevo-paciente').addEventListener('submit', function(e) {
            e.preventDefault();

        // Obtener datos del formulario
        const formData = new FormData(this);
        const pacienteData = {};

        // Convertir FormData a objeto
       for (let [key, value] of formData.entries()) {
          pacienteData[key] = value;
        }

        // Validaciones básicas
        if (!validarFormulario(pacienteData)) {
            return;
        }

        // Aquí iría la lógica para enviar al backend
        console.log('Datos del nuevo paciente:', pacienteData);

        // Simulación de guardado exitoso
        alert('✅ Paciente agregado exitosamente!\n\nNombre: ' + pacienteData.nombres + ' ' + pacienteData.apellidos + '\nCédula: ' + pacienteData.cedula_ecuatoriana);

        // Cerrar modal y limpiar formulario
        cerrarModalPaciente();

        // Aquí podrías actualizar la lista de pacientes
        // actualizarListaPacientes();
    });

    // Función de validación del formulario
    function validarFormulario(data) {
        // Validar campos requeridos
        const camposRequeridos = ['nombres', 'apellidos', 'cedula_ecuatoriana', 'fecha_nacimiento', 'telefono', 'sexo', 'estado_civil', 'direccion'];

        for (let campo of camposRequeridos) {
            if (!data[campo] || data[campo].trim() === '') {
                alert(`❌ Error: El campo "${getCampoNombre(campo)}" es obligatorio.`);
                document.getElementById(campo).focus();
                return false;
            }
        }

        // Validar formato de cédula (10 dígitos)
        if (data.cedula_ecuatoriana && !/^\d{10}$/.test(data.cedula_ecuatoriana)) {
            alert('❌ Error: La cédula ecuatoriana debe tener exactamente 10 dígitos.');
            document.getElementById('cedula_ecuatoriana').focus();
            return false;
        }

        // Validar email si se proporciona
        if (data.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
            alert('❌ Error: Ingrese un correo electrónico válido.');
            document.getElementById('email').focus();
            return false;
        }

        // Validar fecha de nacimiento (no debe ser futura)
        if (data.fecha_nacimiento) {
            const fechaNac = new Date(data.fecha_nacimiento);
            const hoy = new Date();
            if (fechaNac > hoy) {
                alert('❌ Error: La fecha de nacimiento no puede ser futura.');
                document.getElementById('fecha_nacimiento').focus();
                return false;
            }
        }

        return true;
    }

    // Función auxiliar para obtener nombres legibles de campos
    function getCampoNombre(campo) {
        const nombres = {
            'nombres': 'Nombres',
            'apellidos': 'Apellidos',
            'cedula_ecuatoriana': 'Cédula Ecuatoriana',
            'fecha_nacimiento': 'Fecha de Nacimiento',
            'telefono': 'Teléfono',
            'sexo': 'Sexo',
            'estado_civil': 'Estado Civil',
            'direccion': 'Dirección'
        };
        return nombres[campo] || campo;
    }

    // Cerrar modal al hacer clic fuera de él
    document.getElementById('modal-agregar-paciente').addEventListener('click', function(e) {
        if (e.target === this) {
            cerrarModalPaciente();
        }
    });

    // Cerrar modal con tecla Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modal = document.getElementById('modal-agregar-paciente');
            if (!modal.classList.contains('hidden')) {
                cerrarModalPaciente();
            }
        }
    });

    // Formatear cédula mientras se escribe (solo números)
    document.getElementById('cedula_ecuatoriana').addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '');
    });

    // Mostrar/ocultar campo gineco-obstétrico según el sexo
    document.getElementById('sexo').addEventListener('change', function() {
        const ginecoField = document.getElementById('antecedentes_gineco_obstetricos').closest('div');
        if (this.value === 'FEMENINO') {
            ginecoField.style.display = 'block';
        } else {
            ginecoField.style.display = 'none';
            document.getElementById('antecedentes_gineco_obstetricos').value = '';
        }
    });
    // JavaScript para manejar el checkbox
    document.getElementById('consulta-control').addEventListener('change', function() {
        const label = this.nextElementSibling.nextElementSibling;
        if (this.checked) {
            label.textContent = '✓ Sí, es consulta de control';
            label.classList.remove('text-teal-700');
            label.classList.add('text-teal-800', 'font-semibold');
        } else {
            label.textContent = '¿Es consulta de control?';
            label.classList.remove('text-teal-800', 'font-semibold');
            label.classList.add('text-teal-700');
        }
    });
    // Animaciones suaves al cargar
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.card-hover');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });

});

// Función de inicialización que espera el DOM
function inicializarCuandoEsteListo() {
    // Verificar si el documento está listo
    if (document.readyState === 'loading') {
        // Documento aún cargando, esperar el evento DOMContentLoaded
        document.addEventListener('DOMContentLoaded', inicializarAtencion);
    } else {
        // Documento ya cargado, inicializar inmediatamente
        inicializarAtencion();
    }
}

// Múltiples puntos de inicialización para mayor seguridad
document.addEventListener('DOMContentLoaded', function() {
    console.log('📄 DOM cargado, inicializando sistema...');
    inicializarAtencion();
});

window.addEventListener('load', function() {
    console.log('🪟 Ventana cargada');
    if (!atencionMedica) {
        console.log('🔄 Inicialización de respaldo...');
        inicializarAtencion();
    }
});

// Inicialización inmediata si el DOM ya está listo
setTimeout(function() {
    if (!atencionMedica && document.readyState === 'complete') {
        console.log('⏰ Inicialización por timeout...');
        inicializarAtencion();
    }
}, 500);

// Hacer funciones disponibles globalmente
window.verificarSistema = verificarSistema;
window.inicializarAtencion = inicializarAtencion;
window.agregarMedicamento = agregarMedicamento;
window.eliminarMedicamentoSeguro = eliminarMedicamentoSeguro;
window.grabarAtencion = grabarAtencion;
window.agregarDiagnostico = agregarDiagnostico;
window.verDatos = verDatos;

console.log('📜 Script corregido cargado y esperando inicialización...');

</script>

{% endblock %}