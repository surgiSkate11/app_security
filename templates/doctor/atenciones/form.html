{% extends 'home.html' %}
{% block title %}{{ title }}{% endblock %}
{% load static %}
{% block css %}
    <script src="https://cdn.tailwindcss.com"></script>
{% endblock css %}
{% block content %}
<section class="bg-gray-50 min-h-screen">
   <!-- Header -->
   <!-- Navigation Tabs -->
    <nav class="bg-blue-100 shadow-lg sticky top-0 z-10">
        <div class="container mx-auto px-6">
            <div class="flex space-x-0">
                <button onclick="showTab('paciente')" id="tab-paciente" class="tab-button flex-1 py-4 px-6 text-center border-b-3 border-blue-500 text-blue-600 font-semibold transition-all duration-300 hover:bg-blue-50">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>Datos del Paciente</span>
                    </div>
                </button>
                <button onclick="showTab('consultas')" id="tab-consultas" class="tab-button flex-1 py-4 px-6 text-center border-b-3 border-transparent text-gray-500 font-semibold transition-all duration-300 hover:bg-gray-50 hover:text-gray-700">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>Consultas Anteriores</span>
                    </div>
                </button>
                <button onclick="showTab('atencion')" id="tab-atencion" class="tab-button flex-1 py-4 px-6 text-center border-b-3 border-transparent text-gray-500 font-semibold transition-all duration-300 hover:bg-gray-50 hover:text-gray-700">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <span>Atenci√≥n Actual</span>
                    </div>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
     <!-- Datos del Paciente -->
        <div id="content-paciente" class="tab-content active">
            <!-- Selector de Paciente -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 card-hover transition-all duration-300">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
            Selecci√≥n de Paciente
        </h2>

        <div class="flex flex-col md:flex-row gap-4 items-end">
            <div class="flex-1 relative">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Buscar y Seleccionar Paciente</label>

                <!-- Input de b√∫squeda personalizado -->
                <div class="relative">
                    <input
                        type="text"
                        id="paciente-search-input"
                        placeholder="Escriba el nombre, apellido o c√©dula del paciente..."
                        class="w-full p-4 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-700 bg-white"
                        autocomplete="off"
                    >

                    <!-- Indicador de carga -->
                    <div id="loading-indicator" class="absolute right-4 top-1/2 transform -translate-y-1/2 hidden">
                        <svg class="w-5 h-5 text-blue-500 loading-spinner" fill="none" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" class="opacity-25"></circle>
                            <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" class="opacity-75"></path>
                        </svg>
                    </div>

                    <!-- Icono de b√∫squeda -->
                    <div id="search-icon" class="absolute right-4 top-1/2 transform -translate-y-1/2">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>

                    <!-- Bot√≥n de limpiar -->
                    <button
                        id="clear-button"
                        class="absolute right-4 top-1/2 transform -translate-y-1/2 hidden hover:bg-gray-100 rounded-full p-1"
                        onclick="limpiarSeleccion()"
                    >
                        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Dropdown de resultados -->
                <div
                    id="pacientes-dropdown"
                    class="absolute z-50 w-full bg-white border border-gray-200 rounded-xl shadow-lg mt-1 max-h-60 overflow-y-auto dropdown-closed transition-all duration-200"
                >
                    <div id="pacientes-list" class="py-2">
                        <!-- Los resultados se cargar√°n aqu√≠ -->
                    </div>

                    <!-- Mensaje cuando no hay resultados -->
                    <div id="no-results" class="p-4 text-center text-gray-500 hidden">
                        <svg class="w-8 h-8 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        No se encontraron pacientes
                    </div>

                    <!-- Mensaje de m√≠nimo de caracteres -->
                    <div id="min-chars-message" class="p-4 text-center text-gray-500 hidden">
                        <svg class="w-8 h-8 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Escriba al menos 3 caracteres para buscar
                    </div>
                </div>
            </div>

            <button
                onclick="mostrarFormularioNuevoPaciente()"
                class="bg-green-600 hover:bg-green-700 text-white px-6 py-4 rounded-xl transition-colors duration-200 flex items-center space-x-2 font-semibold"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                <span>Agregar Paciente</span>
            </button>
        </div>
    </div>

    <!-- Datos del Paciente Seleccionado -->
    <div id="datos-paciente-container" class="bg-white rounded-2xl shadow-xl p-8 mb-8 hidden">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            Datos del Paciente
        </h3>

        <!-- Informaci√≥n Personal -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="flex items-center space-x-4">
               <div id="paciente-avatar" class="w-12 h-12 rounded-full overflow-hidden">
                    <img id="paciente-foto" src="" alt="Foto del paciente" class="w-full h-full object-cover">
                </div>
                <div>
                    <div id="paciente-nombre" class="font-semibold text-gray-800">Nombre del Paciente</div>
                    <div id="paciente-cedula" class="text-sm text-gray-500">CI: 0000000000</div>
                </div>
            </div>

            <div>
                <div class="text-sm text-gray-500">Tel√©fono</div>
                <div id="paciente-telefono" class="font-medium text-gray-800">--</div>
            </div>

            <div>
                <div class="text-sm text-gray-500">Email</div>
                <div id="paciente-email" class="font-medium text-gray-800">--</div>
            </div>

            <div>
                <div class="text-sm text-gray-500">Edad</div>
                <div id="paciente-edad" class="font-medium text-gray-800">--</div>
            </div>

            <div class="md:col-span-2">
                <div class="text-sm text-gray-500">Direcci√≥n</div>
                <div id="paciente-direccion" class="font-medium text-gray-800">--</div>
            </div>
        </div>

        <!-- Historia Cl√≠nica -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Antecedentes Personales</label>
                <textarea id="antecedentes-personales" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Antecedentes Quir√∫rgicos</label>
                <textarea id="antecedentes-quirurgicos" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Antecedentes Familiares</label>
                <textarea id="antecedentes-familiares" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Alergias</label>
                <textarea id="alergias" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Medicamentos Actuales</label>
                <textarea id="medicamentos-actuales" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">H√°bitos T√≥xicos</label>
                <textarea id="habitos-toxicos" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Vacunas</label>
                <textarea id="vacunas" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>

            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Antecedentes Gineco-obst√©tricos</label>
                <textarea id="antecedentes-gineco" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly></textarea>
            </div>
        </div>
    </div>

    <!-- Mensaje cuando no hay paciente seleccionado -->
    <div id="no-paciente-mensaje" class="bg-white rounded-2xl shadow-xl p-8 text-center">
        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7-7h14a7 7 0 00-7 7z"></path>
            </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Seleccione un paciente</h3>
        <p class="text-gray-500">Para continuar, busque y seleccione un paciente de la lista o agregue uno nuevo.</p>
    </div>

            <!-- Modal Agregar Paciente si no existe -->
            {% include "fragments/modal_paciente.html"  %}
        </div>
        <!-- Consultas Anteriores -->
          <div id="content-consultas" class="tab-content p-8">
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center">
                <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                Historial de Consultas
            </h2>
            <p class="text-gray-600">Registro completo de atenciones m√©dicas anteriores</p>
        </div>

        <div id="consultas-container" class="space-y-6">
            <!-- Las consultas se cargar√°n aqu√≠ din√°micamente -->
        </div>

        <!-- Mensaje cuando no hay consultas -->
        <div id="no-consultas-mensaje" class="text-center py-12 hidden">
            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Sin consultas registradas</h3>
            <p class="text-gray-500">Este paciente no tiene atenciones m√©dicas registradas en el sistema.</p>
        </div>
    </div>

        <!-- Atenci√≥n Actual -->
         <div id="content-atencion" class="tab-content">
            <div class="space-y-8">
                <!-- Identificaci√≥n -->
              <form id="atencion-form" onsubmit="event.preventDefault(); grabarAtencion();">
                    {% csrf_token %}
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center mr-4">
                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                            </div>
                            Identificaci√≥n de la Atenci√≥n
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                            <div class="bg-blue-50 p-2 rounded-xl border-l-4 border-blue-400 md:col-span-2">
                                <h3 class="font-semibold text-blue-800 mb-2">Paciente</h3>
                                <p id="paciente-nombre2" class="text-blue-700 text-lg">Vera, Erick</p>
                                <!-- Campo oculto para capturar ID del paciente -->
                                <input  id="id_paciente">
                            </div>
                            <div class="bg-green-50 p-2 rounded-xl border-l-4 border-green-400 text-center ">
                                 <div id="paciente-avatar2" class="w-24 h-24 rounded-full overflow-hidden mx-auto">
                                    <img id="paciente-foto2" src="" alt="Foto del paciente" class="w-full h-full object-cover">

                                </div>
                                 <span id="paciente-edad2" class="text-blue-800 text-1xl font-bold">Edad</span>
                                <!-- Campo oculto para capturar ID del doctor -->
                                <input type="hidden" id="id_doctor" value="1">
                            </div>

                        </div>
                    </div>

                    <!-- Signos Vitales -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </div>
                            Signos Vitales y Mediciones
                        </h3>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-red-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-red-800 text-sm">Presi√≥n Arterial</h4>
                                <input type="text" id="id_presion_arterial" value="{{ atencion.presion_arterial|default:'' }}" class="w-full mt-2 p-2 border border-red-200 rounded-lg text-center font-bold text-red-700" placeholder="120/80">
                            </div>
                            <div class="bg-pink-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-pink-800 text-sm">Pulso (ppm)</h4>
                                <input type="number" id="id_pulso" value="{{ atencion.pulso|default:'' }}" class="w-full mt-2 p-2 border border-pink-200 rounded-lg text-center font-bold text-pink-700" placeholder="72">
                            </div>
                            <div class="bg-orange-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-orange-800 text-sm">Temperatura (¬∞C)</h4>
                                <input type="number" step="0.1" id="id_temperatura" value="{{ atencion.temperatura|stringformat:'g'|default:'' }}" class="w-full mt-2 p-2 border border-orange-200 rounded-lg text-center font-bold text-orange-700" placeholder="36.5">
                            </div>
                            <div class="bg-blue-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-blue-800 text-sm">Freq. Respiratoria</h4>
                                <input type="number" id="id_frecuencia_respiratoria" value="{{ atencion.frecuencia_respiratoria|stringformat:'g'|default:'' }}" class="w-full mt-2 p-2 border border-blue-200 rounded-lg text-center font-bold text-blue-700" placeholder="16">
                            </div>
                            <div class="bg-green-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-green-800 text-sm">Saturaci√≥n O2 (%)</h4>
                                <input type="number" id="id_saturacion_oxigeno" value="{{ atencion.saturacion_oxigeno|stringformat:'g'|default:'' }}" class="w-full mt-2 p-2 border border-green-200 rounded-lg text-center font-bold text-green-700" placeholder="98">
                            </div>
                            <div class="bg-purple-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-purple-800 text-sm">Peso (kg)</h4>
                                <input type="number" step="0.1" id="id_peso" value="{{ atencion.peso|stringformat:'g'|default:'' }}" class="w-full mt-2 p-2 border border-purple-200 rounded-lg text-center font-bold text-purple-700" placeholder="70.5">
                            </div>
                            <div class="bg-indigo-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-indigo-800 text-sm">Altura (m)</h4>
                                <input type="number" step="0.01" id="id_altura" value="{{ atencion.altura|stringformat:'g' }}" class="w-full mt-2 p-2 border border-indigo-200 rounded-lg text-center font-bold text-indigo-700" placeholder="1.75">
                            </div>
                            <div class="bg-teal-50 p-4 rounded-xl text-center">
                                <h4 class="font-semibold text-teal-800 text-sm mb-3">Consulta Control</h4>
                                <div class="flex items-center justify-center">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="id_consulta_control" {% if atencion.es_control %}checked{% endif %} class="sr-only">
                                        <div class="relative">
                                            <div class="w-10 h-6 bg-teal-200 rounded-full shadow-inner transition-colors duration-200 ease-in-out"></div>
                                            <div class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transform transition-transform duration-200 ease-in-out"></div>
                                        </div>
                                        <span class="ml-3 text-sm font-medium text-teal-700">¬øEs consulta de control?</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Evaluaci√≥n Cl√≠nica -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            Evaluaci√≥n Cl√≠nica
                        </h3>

                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Motivo de Consulta *</label>
                                    <div class="flex items-center gap-2">
                                        <textarea id="id_motivo_consulta" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Ingrese el motivo de la consulta..."></textarea>
                                        <button type="button" class="mic-btn" onclick="startDictation('id_motivo_consulta')" title="Dictar por voz" style="margin-left:5px;vertical-align:middle;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 15a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a1 1 0 1 1 2 0 7 7 0 0 1-6 6.92V21h3a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h3v-2.08A7 7 0 0 1 5 12a1 1 0 1 1 2 0 5 5 0 0 0 10 0z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">S√≠ntomas *</label>
                                    <div class="flex items-center gap-2">
                                        <textarea id="id_sintomas" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Describa los s√≠ntomas presentados..."></textarea>
                                        <button type="button" class="mic-btn" onclick="startDictation('id_sintomas')" title="Dictar por voz" style="margin-left:5px;vertical-align:middle;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M12 15a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a1 1 0 1 1 2 0 7 7 0 0 1-6 6.92V21h3a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h3v-2.08A7 7 0 0 1 5 12a1 1 0 1 1 2 0 5 5 0 0 0 10 0z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Examen F√≠sico</label>
                                <div class="flex items-center gap-2">
                                    <textarea id="id_examen_fisico" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="4" placeholder="Hallazgos del examen f√≠sico..."></textarea>
                                    <button type="button" class="mic-btn" onclick="startDictation('id_examen_fisico')" title="Dictar por voz" style="margin-left:5px;vertical-align:middle;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 15a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a1 1 0 1 1 2 0 7 7 0 0 1-6 6.92V21h3a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h3v-2.08A7 7 0 0 1 5 12a1 1 0 1 1 2 0 5 5 0 0 0 10 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Comentario Adicional</label>
                                <div class="flex items-center gap-2">
                                    <textarea id="id_comentario_adicional" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Comentarios adicionales..."></textarea>
                                    <button type="button" class="mic-btn" onclick="startDictation('id_comentario_adicional')" title="Dictar por voz" style="margin-left:5px;vertical-align:middle;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 15a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a1 1 0 1 1 2 0 7 7 0 0 1-6 6.92V21h3a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h3v-2.08A7 7 0 0 1 5 12a1 1 0 1 1 2 0 5 5 0 0 0 10 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Diagn√≥sticos -->
                    <div class="bg-pink-50 border border-gray-300 rounded-lg ">
                     <label class="block text-sm font-semibold text-pink-800 mb-2">Diagnotico(s) *</label>
                      <div class="bg-gray-50 p-4 rounded-xl">
                        <div class="flex items-center space-x-3 mb-3">
                            <select
                                id="id_diagnostico"
                                multiple
                                class="flex-1 p-3 border border-gray-300 rounded-lg h-32 bg-white"
                                size="5">
                                {% for diagnostico in diagnosticos %}
                                    <option
                                        value="{{ diagnostico.id }}"
                                        {% if atencion and diagnostico in atencion.diagnostico.all %}selected{% endif %}
                                        title="{{ diagnostico.datos_adicionales|default:'' }}">
                                     {{ diagnostico.codigo }} - {{ diagnostico.descripcion }}
                                    </option>
                                {% empty %}
                                    <option value="" disabled>No hay diagn√≥sticos disponibles</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div id="diagnosticos-lista" class="text-sm text-gray-600">
                            <!-- Aqu√≠ aparecer√°n los diagn√≥sticos seleccionados -->
                        </div>
                    </div>
                    </div>
                   <!-- fin diagnosticos-->

             </div>
            </div>

            <!-- Signos Vitales -->
            <div class="lg:col-span-1">
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl">
                    <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-4 h-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                        Signos Vitales
                    </h4>
                    <div class="space-y-3">
                        ${crearSignosVitalesHTML(atencion)}
                    </div>
                </div>
            </div>
        </div>
    `;

    return consultaDiv;
}

/*
 * Funci√≥n para obtener configuraci√≥n de colores seg√∫n tipo de consulta
 * @param {string} tipoConsulta - Tipo de consulta
 * @returns {Object} - Configuraci√≥n de colores
 */
function getColorConfig(tipoConsulta) {
    const configs = {
        'Control': {
            border: 'border-blue-500',
            dot: 'bg-blue-500',
            badge: 'bg-blue-100 text-blue-800'
        },
        'Urgencia': {
            border: 'border-green-500',
            dot: 'bg-green-500',
            badge: 'bg-green-100 text-green-800'
        },
        'Chequeo': {
            border: 'border-purple-500',
            dot: 'bg-purple-500',
            badge: 'bg-purple-100 text-purple-800'
        }
    };

    return configs[tipoConsulta] || configs['Chequeo'];
}

/*
 * Funci√≥n para crear HTML de signos vitales
 * @param {Object} atencion - Datos de la atenci√≥n
 * @returns {string} - HTML de los signos vitales
 */
function crearSignosVitalesHTML(atencion) {
    const signos = [
        { label: 'Presi√≥n Arterial:', valor: atencion.presion_arterial },
        { label: 'Pulso:', valor: atencion.pulso ? `${atencion.pulso} ppm` : null },
        { label: 'Temperatura:', valor: atencion.temperatura ? `${atencion.temperatura}¬∞C` : null },
        { label: 'Freq. Respiratoria:', valor: atencion.frecuencia_respiratoria ? `${atencion.frecuencia_respiratoria} rpm` : null },
        { label: 'Saturaci√≥n O2:', valor: atencion.saturacion_oxigeno ? `${atencion.saturacion_oxigeno}%` : null },
        { label: 'Peso:', valor: atencion.peso ? `${atencion.peso} kg` : null },
        { label: 'Altura:', valor: atencion.altura ? `${atencion.altura} m` : null },
        { label: 'IMC:', valor: atencion.imc ? atencion.imc : null }
    ];

    return signos
        .filter(signo => signo.valor)
        .map(signo => `
            <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600">${signo.label}</span>
                <span class="font-semibold text-gray-800">${signo.valor}</span>
            </div>
        `).join('');
}

/*
 * Funci√≥n para crear HTML de prescripciones
 * @param {Array} prescripciones - Lista de prescripciones
 * @returns {string} - HTML de las prescripciones
 */
function crearPrescripcionesHTML(prescripciones) {
    if (!prescripciones || prescripciones.length === 0) {
        return '';
    }

    const prescripcionesHTML = prescripciones.map(prescripcion => `
        <div class="bg-orange-50 border-l-4 border-orange-400 p-4 rounded-r-xl">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="w-5 h-5 text-orange-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </div>
                <div class="ml-3 flex-1">
                    <h6 class="text-sm font-semibold text-orange-800">${prescripcion.medicamento || 'Medicamento no especificado'}</h6>
                    <p class="text-sm text-orange-700 mt-1">${prescripcion.prescripcion || 'Sin instrucciones'}</p>
                    <div class="mt-2 text-xs text-orange-600 space-x-4">
                        ${prescripcion.cantidad ? `<span>Cantidad: ${prescripcion.cantidad}</span>` : ''}
                        ${prescripcion.frecuencia_diaria ? `<span>Frecuencia: ${prescripcion.frecuencia_diaria} veces/d√≠a</span>` : ''}
                        ${prescripcion.duracion_tratamiento ? `<span>Duraci√≥n: ${prescripcion.duracion_tratamiento} d√≠as</span>` : ''}
                    </div>
                </div>
            </div>
        </div>
    `).join('');

    return `
        <div class="bg-orange-25 p-4 rounded-xl">
            <h4 class="font-semibold text-orange-800 text-sm mb-3">Prescripciones</h4>
            <div class="space-y-3">
                ${prescripcionesHTML}
            </div>
        </div>
    `;
}

/*
 * Funci√≥n para integrar con el selector de pacientes
 * @param {Object} paciente - Datos del paciente
 */
function cargarConsultasPaciente(paciente) {
    if (paciente && paciente.atenciones) {
        cargarConsultas(paciente.atenciones);
    } else {
        cargarConsultas([]);
    }
}

// ==============================
// 6. MODAL PARA NUEVO PACIENTE
// ==============================

/*
 * Funci√≥n para mostrar formulario de nuevo paciente
 */
function mostrarFormularioNuevoPaciente() {
    document.getElementById('modal-agregar-paciente').classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // Prevenir scroll del body
}

/*
 * Funci√≥n para cerrar modal
 */
function cerrarModalPaciente() {
    document.getElementById('modal-agregar-paciente').classList.add('hidden');
    document.body.style.overflow = 'auto'; // Restaurar scroll del body
    document.getElementById('form-nuevo-paciente').reset(); // Limpiar formulario
}

/*
 * Funci√≥n para toggle del acorde√≥n
 * @param {string} section - Secci√≥n del acorde√≥n
 */
function toggleAccordion(section) {
    const content = document.getElementById(`content-${section}`);
    const icon = document.getElementById(`icon-${section}`);

    if (content.classList.contains('hidden')) {
        content.classList.remove('hidden');
        icon.classList.remove('rotate-180');
    } else {
        content.classList.add('hidden');
        icon.classList.add('rotate-180');
    }
}

/*
 * Funci√≥n de validaci√≥n del formulario de paciente
 * @param {Object} data - Datos del formulario
 * @returns {boolean} - True si es v√°lido
 */
function validarFormulario(data) {
    // Validar campos requeridos
    const camposRequeridos = ['nombres', 'apellidos', 'cedula_ecuatoriana', 'fecha_nacimiento', 'telefono', 'sexo', 'estado_civil', 'direccion'];

    for (let campo of camposRequeridos) {
        if (!data[campo] || data[campo].trim() === '') {
            alert(`‚ùå Error: El campo "${getCampoNombre(campo)}" es obligatorio.`);
            document.getElementById(campo).focus();
            return false;
        }
    }

    // Validar formato de c√©dula (10 d√≠gitos)
    if (data.cedula_ecuatoriana && !/^\d{10}$/.test(data.cedula_ecuatoriana)) {
        alert('‚ùå Error: La c√©dula ecuatoriana debe tener exactamente 10 d√≠gitos.');
        document.getElementById('cedula_ecuatoriana').focus();
        return false;
    }

    // Validar email si se proporciona
    if (data.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
        alert('‚ùå Error: Ingrese un correo electr√≥nico v√°lido.');
        document.getElementById('email').focus();
        return false;
    }

    // Validar fecha de nacimiento (no debe ser futura)
    if (data.fecha_nacimiento) {
        const fechaNac = new Date(data.fecha_nacimiento);
        const hoy = new Date();
        if (fechaNac > hoy) {
            alert('‚ùå Error: La fecha de nacimiento no puede ser futura.');
            document.getElementById('fecha_nacimiento').focus();
            return false;
        }
    }

    return true;
}

/*
 * Funci√≥n auxiliar para obtener nombres legibles de campos
 * @param {string} campo - Nombre del campo
 * @returns {string} - Nombre legible
 */
function getCampoNombre(campo) {
    const nombres = {
        'nombres': 'Nombres',
        'apellidos': 'Apellidos',
        'cedula_ecuatoriana': 'C√©dula Ecuatoriana',
        'fecha_nacimiento': 'Fecha de Nacimiento',
        'telefono': 'Tel√©fono',
        'sexo': 'Sexo',
        'estado_civil': 'Estado Civil',
        'direccion': 'Direcci√≥n'
    };
    return nombres[campo] || campo;
}

/*
 * Obtener token CSRF para Django
 * @param {string} name - Nombre de la cookie
 * @returns {string|null} - Valor de la cookie
 */
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// ==============================
// 7. FUNCIONES GLOBALES SEGURAS
// ==============================

/*
 * Funci√≥n para inicializar de forma segura
 * @returns {boolean} - True si se inicializ√≥ correctamente
 */
function inicializarAtencion() {
    try {
        console.log('üîÑ Intentando inicializar el sistema...');
        atencionMedica = new GestorAtencionMedica();
        console.log('‚úÖ Sistema de atenci√≥n m√©dica inicializado correctamente');
        console.log('üìã Instancia creada:', atencionMedica);
        return true;
    } catch (error) {
        console.error('‚ùå Error al inicializar:', error);
        alert('Error al inicializar el sistema: ' + error.message);
        return false;
    }
}

/*
 * Funci√≥n global para agregar medicamento
 */
function agregarMedicamento() {
    console.log('üîÑ Funci√≥n agregarMedicamento() llamada');

    if (!atencionMedica) {
        console.log('‚ö†Ô∏è Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    try {
        atencionMedica.agregarMedicamento();
    } catch (error) {
        console.error('‚ùå Error en agregarMedicamento:', error);
        alert('Error al agregar medicamento: ' + error.message);
    }
}

/*
 * Funci√≥n global para eliminar medicamento de forma segura
 * @param {number} index - √çndice del medicamento a eliminar
 */
function eliminarMedicamentoSeguro(index) {
    if (atencionMedica) {
        atencionMedica.eliminarMedicamento(index);
    } else {
        console.error('‚ùå Sistema no inicializado');
    }
}

/*
 * Funci√≥n global para grabar atenci√≥n
 */
function grabarAtencion() {
    console.log('üîÑ Funci√≥n grabarAtencion() llamada');

    if (!atencionMedica) {
        console.log('‚ö†Ô∏è Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    try {
        atencionMedica.grabarAtencion();
    } catch (error) {
        console.error('‚ùå Error en grabarAtencion:', error);
        alert('Error al grabar atenci√≥n: ' + error.message);
    }
}

/*
 * Funci√≥n global para agregar diagn√≥stico
 */
function agregarDiagnostico() {
    console.log('üîÑ Funci√≥n agregarDiagnostico() llamada');

    if (!atencionMedica) {
        console.log('‚ö†Ô∏è Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    try {
        atencionMedica.agregarDiagnostico();
    } catch (error) {
        console.error('‚ùå Error en agregarDiagnostico:', error);
        alert('Error al agregar diagn√≥stico: ' + error.message);
    }
}

/*
 * Funci√≥n global para ver datos
 */
function verDatos() {
    if (!atencionMedica) {
        console.log('‚ö†Ô∏è Sistema no inicializado, intentando inicializar...');
        if (!inicializarAtencion()) {
            return;
        }
    }

    atencionMedica.verDatos();
}

/*
 * Funci√≥n para verificar el estado del sistema
 * @returns {boolean} - Estado del sistema
 */
function verificarSistema() {
    console.log('üîç Estado del sistema:');
    console.log('   atencionMedica:', atencionMedica);
    console.log('   Tipo:', typeof atencionMedica);
    console.log('   DOM ready:', document.readyState);
    return atencionMedica !== null;
}

// ==============================
// 8. INICIALIZACI√ìN Y EVENTOS CONSOLIDADOS
// ==============================

/*
 * Funci√≥n principal de inicializaci√≥n cuando el DOM est√° listo
 */
document.addEventListener('DOMContentLoaded', function() {
    console.log('üìÑ DOM cargado, inicializando sistema completo...');

    // ============================================
    // 8.1 INICIALIZAR SISTEMA DE ATENCI√ìN M√âDICA
    // ============================================
    inicializarAtencion();

    // ============================================
    // 8.2 INICIALIZAR SELECTOR DE PACIENTES
    // ============================================
    // Obtener elementos DOM
    searchInput = document.getElementById('paciente-search-input');
    dropdown = document.getElementById('pacientes-dropdown');
    pacientesList = document.getElementById('pacientes-list');
    loadingIndicator = document.getElementById('loading-indicator');
    searchIcon = document.getElementById('search-icon');
    clearButton = document.getElementById('clear-button');
    noResults = document.getElementById('no-results');
    minCharsMessage = document.getElementById('min-chars-message');
    datosContainer = document.getElementById('datos-paciente-container');
    noMensaje = document.getElementById('no-paciente-mensaje');

    // Configurar Event Listeners para selector de pacientes
    if (searchInput) {
        searchInput.addEventListener('input', handleSearchInput);
        searchInput.addEventListener('focus', handleInputFocus);
        searchInput.addEventListener('blur', handleInputBlur);
    }

    document.addEventListener('click', handleDocumentClick);
     // ============================================
    // 8.2.1 CARGAR PACIENTE EN MODO EDICI√ìN
    // ============================================
    // Si estamos editando una atenci√≥n, cargar el paciente autom√°ticamente
    if (typeof pacienteDesdeServidor !== 'undefined' && pacienteDesdeServidor !== null) {
        console.log('üîÑ Cargando paciente para edici√≥n:', pacienteDesdeServidor.nombres, pacienteDesdeServidor.apellidos);
        seleccionarPaciente(pacienteDesdeServidor);
    }
    // Fin de cargar paciente en modo edicion


    // ============================================
    // 8.3 INICIALIZAR MODAL DE NUEVO PACIENTE
    // ============================================
    const formNuevoPaciente = document.getElementById('form-nuevo-paciente');
    if (formNuevoPaciente) {
        formNuevoPaciente.addEventListener('submit', function(e) {
            e.preventDefault();

            // Obtener datos del formulario
            const formData = new FormData(this);
            const pacienteData = {};

            // Convertir FormData a objeto
            for (let [key, value] of formData.entries()) {
                pacienteData[key] = value;
            }

            // Validaciones b√°sicas
            if (!validarFormulario(pacienteData)) {
                return;
            }

            // Aqu√≠ ir√≠a la l√≥gica para enviar al backend
            console.log('Datos del nuevo paciente:', pacienteData);

            // Simulaci√≥n de guardado exitoso
            alert('‚úÖ Paciente agregado exitosamente!\n\nNombre: ' + pacienteData.nombres + ' ' + pacienteData.apellidos + '\nC√©dula: ' + pacienteData.cedula_ecuatoriana);

            // Cerrar modal y limpiar formulario
            cerrarModalPaciente();
        });
    }

    // ============================================
    // 8.4 CONFIGURAR EVENTOS ADICIONALES
    // ============================================

    // Cerrar modal al hacer clic fuera de √©l
    const modalAgregarPaciente = document.getElementById('modal-agregar-paciente');
    if (modalAgregarPaciente) {
        modalAgregarPaciente.addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarModalPaciente();
            }
        });
    }

    // Formatear c√©dula mientras se escribe (solo n√∫meros)
    const cedulaInput = document.getElementById('cedula_ecuatoriana');
    if (cedulaInput) {
        cedulaInput.addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '');
        });
    }

    // Mostrar/ocultar campo gineco-obst√©trico seg√∫n el sexo
    const sexoSelect = document.getElementById('sexo');
    if (sexoSelect) {
        sexoSelect.addEventListener('change', function() {
            const ginecoField = document.getElementById('antecedentes_gineco_obstetricos');
            if (ginecoField) {
                const ginecoContainer = ginecoField.closest('div');
                if (this.value === 'FEMENINO') {
                    ginecoContainer.style.display = 'block';
                } else {
                    ginecoContainer.style.display = 'none';
                    ginecoField.value = '';
                }
            }
        });
    }

    // JavaScript para manejar el checkbox de consulta de control
    const consultaControlCheckbox = document.getElementById('consulta-control');
    if (consultaControlCheckbox) {
        consultaControlCheckbox.addEventListener('change', function() {
            const label = this.nextElementSibling.nextElementSibling;
            if (this.checked) {
                label.textContent = '‚úì S√≠, es consulta de control';
                label.classList.remove('text-teal-700');
                label.classList.add('text-teal-800', 'font-semibold');
            } else {
                label.textContent = '¬øEs consulta de control?';
                label.classList.remove('text-teal-800', 'font-semibold');
                label.classList.add('text-teal-700');
            }
        });
    }

    // ============================================
    // 8.5 ANIMACIONES SUAVES AL CARGAR
    // ============================================
    const cards = document.querySelectorAll('.card-hover');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
    });

    console.log('‚úÖ Sistema completo inicializado correctamente');
});

// ============================================
// 8.6 EVENTOS ADICIONALES DE RESPALDO
// ============================================

// Cerrar modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modal = document.getElementById('modal-agregar-paciente');
        if (modal && !modal.classList.contains('hidden')) {
            cerrarModalPaciente();
        }
    }
});

// Respaldo initialization when window loads
window.addEventListener('load', function() {
    console.log('ü™ü Ventana cargada');
    if (!atencionMedica) {
        console.log('üîÑ Inicializaci√≥n de respaldo...');
        inicializarAtencion();
    }
});

// Timeout initialization as last resort
setTimeout(function() {
    if (!atencionMedica && document.readyState === 'complete') {
        console.log('‚è∞ Inicializaci√≥n por timeout...');
        inicializarAtencion();
    }
}, 500);

// ==============================
// 9. EXPOSICI√ìN DE FUNCIONES GLOBALES
// ==============================

// Hacer funciones disponibles globalmente para el HTML
window.verificarSistema = verificarSistema;
window.inicializarAtencion = inicializarAtencion;
window.agregarMedicamento = agregarMedicamento;
window.eliminarMedicamentoSeguro = eliminarMedicamentoSeguro;
window.grabarAtencion = grabarAtencion;
window.agregarDiagnostico = agregarDiagnostico;
window.verDatos = verDatos;
window.showTab = showTab;
window.mostrarFormularioNuevoPaciente = mostrarFormularioNuevoPaciente;
window.cerrarModalPaciente = cerrarModalPaciente;
window.toggleAccordion = toggleAccordion;
window.limpiarSeleccion = limpiarSeleccion;

console.log('üìú Sistema de Atenci√≥n M√©dica - C√≥digo organizado cargado y esperando inicializaci√≥n...');

function showTab(tab) {
    // Oculta todos los contenidos de pesta√±as
    document.querySelectorAll('.tab-content').forEach(function(content) {
        content.classList.remove('active');
        content.classList.add('hidden');
    });
    // Quita el color activo de todos los botones
    document.querySelectorAll('.tab-button').forEach(function(btn) {
        btn.classList.remove('border-blue-500', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
    });
    // Muestra el contenido de la pesta√±a seleccionada
    var content = document.getElementById('content-' + tab);
    if (content) {
        content.classList.add('active');
        content.classList.remove('hidden');
    }
    // Activa el bot√≥n de la pesta√±a seleccionada
    var btn = document.getElementById('tab-' + tab);
    if (btn) {
        btn.classList.add('border-blue-500', 'text-blue-600');
        btn.classList.remove('border-transparent', 'text-gray-500');
    }
}
window.showTab = showTab;
{% endblock content %}